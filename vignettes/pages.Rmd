---
title: "Pages: Deep Dive"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Pages: Deep Dive}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

```{r setup, message=FALSE, warning=FALSE}
library(dashboardr)
library(dplyr)
library(gssr)
# Load latest wave only
data(gss_all)
gss <- gss_all %>%
  select(year, age, sex, race, degree, happy, polviews) %>%
  filter(year == max(year, na.rm = TRUE), !is.na(age), !is.na(sex), !is.na(race), !is.na(degree))
```

This vignette goes deep into pages - the second layer of dashboardr's architecture. For a quick overview, see `vignette("getting-started")`.

## What Pages Do

Pages serve as **containers** that:

1. Hold content collections
2. Associate data with visualizations
3. Configure page-specific settings (icons, overlays, lazy loading)
4. Define position in the dashboard navbar

Think of pages as "destinations" in your dashboard - each page is a separate HTML file that users navigate to.

## Creating Pages

### The create_page() Function

```{r}
page <- create_page(
  "Analysis",
  data = gss,
  type = "bar"  # Default viz type for this page
) %>%
  add_viz(x_var = "degree", title = "Education")

print(page)
```

```{r}
page %>% preview()
```

### Adding Content to Pages

There are two ways to add content:

**Method 1: Add pre-built content collections**

```{r}
# Build content separately
demographics <- create_content(type = "bar") %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "demo") %>%
  add_viz(x_var = "race", title = "Race", tabgroup = "demo")

# Add to page
page1 <- create_page("Analysis", data = gss) %>%
  add_content(demographics)

print(page1)
```

```{r}
page1 %>% preview()
```

**Method 2: Add content directly to the page**

```{r}
# Build content directly on the page
page2 <- create_page("Analysis", data = gss, type = "bar") %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "demo") %>%
  add_viz(x_var = "race", title = "Race", tabgroup = "demo") %>%
  add_text("## Summary", "", "Key findings from the analysis.")

print(page2)
```

```{r}
page2 %>% preview()
```

Both methods work - use whichever fits your workflow better.

## Page Types

### Landing Pages

Full-width pages without sidebar, ideal for welcome screens:

```{r}
home <- create_page(
  "Home",
  is_landing_page = TRUE
) %>%
  add_text(
    "# Welcome to the GSS Dashboard",
    "",
    "Explore insights from the General Social Survey (2010-2024).",
    "",
    "## What You'll Find",
    "",
    "This dashboard presents analysis of:",
    "",
    "- **Demographics** - Age, education, race distributions",
    "- **Attitudes** - Happiness, political views, social trust",
    "- **Trends** - Changes over time in key indicators",
    "",
    "## Getting Started",
    "",
    "Click on the **Analysis** tab above to begin exploring the data.",
    "Use the tabs within each page to navigate between different views."
  ) %>%
  add_callout("Data source: General Social Survey, NORC at University of Chicago", type = "note")

print(home)
```

### Analysis Pages

Standard pages with data and visualizations:

```{r}
# Create content
charts <- create_content(type = "bar") %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "overview") %>%
  add_viz(x_var = "happy", title = "Happiness", tabgroup = "overview")

trends <- create_content(type = "stackedbar") %>%
  add_viz(x_var = "degree", stack_var = "happy", title = "Happiness by Education",
          tabgroup = "crosstabs", stacked_type = "percent")

# Create page with content
analysis <- create_page("Analysis", data = gss) %>%
  add_content(charts) %>%
  add_content(trends)

print(analysis)
```

```{r}
analysis %>% preview()
```

### Text-Only Pages

For documentation, methodology, or about sections:

```{r}
about <- create_page("About") %>%
  add_text(
    "## About This Dashboard",
    "",
    "This dashboard was created using [dashboardr](https://github.com/favstats/dashboardr).",
    "",
    "### Methodology",
    "",
    "The General Social Survey (GSS) is a nationally representative survey of adults",
    "in the United States, conducted by NORC at the University of Chicago.",
    "",
    "### Data Processing",
    "",
    "- Filtered to years 2010-2024",
    "- Removed cases with missing demographic data",
    "- Applied survey weights where appropriate",
    "",
    "### Contact",
    "",
    "For questions about this dashboard, please contact the research team."
  ) %>%
  add_callout("Last updated: January 2025", type = "note")

print(about)
```

## Page Settings

### Icons

Icons appear in the navbar next to page names:

```{r}
page <- create_page("Analysis", icon = "ph:chart-bar-fill")
```

Popular icons from [Phosphor Icons](https://phosphoricons.com/):

| Icon | Code |
|------|------|
| Home | `ph:house-fill` |
| Chart | `ph:chart-bar-fill` |
| Line chart | `ph:chart-line` |
| Users | `ph:users-fill` |
| Info | `ph:info-fill` |
| Settings | `ph:gear-fill` |

### Navbar Alignment

Put pages on the right side of the navbar:

```{r}
about <- create_page("About", navbar_align = "right")
settings <- create_page("Settings", navbar_align = "right")
```

### Page-Level Defaults

Set visualization defaults at the page level:

```{r}
page <- create_page(
  "Survey Results",
  data = gss,
  type = "bar",                    # Default viz type
  color_palette = c("#3498DB"),    # Default colors
  drop_na_vars = TRUE              # Default NA handling
) %>%
  add_viz(x_var = "degree", title = "Education") %>%
  add_viz(x_var = "happy", title = "Happiness", color_palette = c("#E74C3C"))

print(page)
```

```{r}
page %>% preview()
```

## Performance Settings

### Loading Overlays

Show a spinner while the page loads:

```{r}
heavy_page <- create_page(
  "Heavy Analysis",
  data = gss,
  overlay = TRUE,
  overlay_theme = "glass",      # Options: "glass", "light", "dark", "accent"
  overlay_text = "Loading analysis...",
  overlay_duration = 1500       # Milliseconds
)
```

This is especially useful for pages with many visualizations or large datasets.

### Lazy Loading

Load charts only as the user scrolls to them:

```{r}
large_page <- create_page(
  "Large Dashboard",
  data = gss,
  lazy_load_charts = TRUE,       # Load charts on scroll
  lazy_load_margin = "300px",    # Start loading 300px before visible
  lazy_load_tabs = TRUE          # Load tab content only when clicked
)
```

**When to use lazy loading:**

- Pages with 10+ visualizations
- Pages with complex charts (heatmaps, timelines)
- Dashboards with many tabs

### Combining Performance Settings

```{r}
optimized_page <- create_page(
  "Optimized",
  data = gss,
  overlay = TRUE,
  overlay_theme = "glass",
  overlay_duration = 1000,
  lazy_load_charts = TRUE,
  lazy_load_margin = "200px",
  lazy_load_tabs = TRUE
)
```

## Tab Styling

Customize tab appearance at the page level:

```{r}
styled_page <- create_page(
  "Styled Tabs",
  data = gss,
  tabset_theme = "modern",
  tabset_colors = list(
    active_bg = "#3498DB",
    active_text = "#FFFFFF",
    inactive_bg = "#ECF0F1",
    inactive_text = "#7F8C8D",
    hover_bg = "#BDC3C7"
  )
)
```

Available themes: `"default"`, `"modern"`, `"pills"`, `"minimal"`

## Combining Multiple Content Collections

A single page can hold multiple content collections:

```{r}
# Demographics section
demographics <- create_content(type = "bar") %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "demo") %>%
  add_viz(x_var = "race", title = "Race", tabgroup = "demo")

# Attitudes section
attitudes <- create_content(type = "bar") %>%
  add_viz(x_var = "happy", title = "Happiness", tabgroup = "attitudes") %>%
  add_viz(x_var = "polviews", title = "Politics", tabgroup = "attitudes")

# Cross-tabs section
crosstabs <- create_content(type = "stackedbar") %>%
  add_viz(x_var = "degree", stack_var = "happy", title = "Happiness by Education",
          tabgroup = "crosstabs", stacked_type = "percent")

# Combine all into one page
full_analysis <- create_page("Full Analysis", data = gss) %>%
  add_content(demographics) %>%
  add_content(attitudes) %>%
  add_content(crosstabs)

print(full_analysis)
```

Preview the combined page:

```{r}
full_analysis %>% preview()
```

## Previewing Pages

Test pages before adding to a dashboard:

```{r, eval=FALSE}
# Quick preview
page %>% preview()

# Full Quarto preview
page %>% preview(quarto = TRUE)

# Save to file
page %>% preview(path = "page_preview.html")
```

## Data Inheritance

When you set `data` on a page, all visualizations in that page's content collections inherit it:

```{r}
# Content collection WITHOUT data
charts <- create_content(type = "bar") %>%
  add_viz(x_var = "degree", title = "Education")

# Page WITH data - charts will use the page's data
page <- create_page("Analysis", data = gss) %>%
  add_content(charts)

print(page)
```

If content collections have their own data, it takes precedence:

```{r}
# Content collection WITH its own data
specific_charts <- create_content(data = gss %>% filter(year == 2020), type = "bar") %>%
  add_viz(x_var = "degree", title = "Education (2020 only)")

# Page data is ignored for this content
page <- create_page("Analysis", data = gss) %>%
  add_content(specific_charts)
```

## Page Types Gallery

This gallery demonstrates all page types and configurations with both `print()` (structure) and `preview()` (rendered) output.

### Standard Analysis Page

The most common page type - data with visualizations.

```{r}
analysis_page <- create_page("Analysis", data = gss, type = "bar") %>%
  add_viz(x_var = "degree", title = "Education Distribution") %>%
  add_text("## Key Finding", "", "Education levels are distributed across the population.")

print(analysis_page)
```

```{r}
analysis_page %>% preview()
```

### Landing Page (Full Width)

Welcome pages without sidebars - great for introductions.

```{r}
landing <- create_page("Welcome", is_landing_page = TRUE) %>%
  add_text(
    "# Welcome to the GSS Dashboard",
    "",
    "Explore insights from the General Social Survey.",
    "",
    "### Quick Navigation",
    "",
    "- **Demographics** - Age, education, race",
    "- **Attitudes** - Happiness, politics, trust",
    "- **Trends** - Changes over time"
  ) %>%
  add_callout("Click the tabs above to begin exploring!", type = "tip")

print(landing)
```

```{r}
landing %>% preview()
```

### Text-Only Page

Documentation, methodology, or about pages.

```{r}
methodology <- create_page("Methodology") %>%
  add_text(
    "## Methodology",
    "",
    "### Data Source",
    "",
    "The General Social Survey (GSS) is conducted by NORC at the University of Chicago.",
    "",
    "### Sample",
    "",
    "- **Years**: 2010-2024",
    "- **Sample Size**: 21,788 respondents",
    "- **Sampling**: Stratified random sampling"
  ) %>%
  add_accordion(
    title = "Technical Details",
    text = "Margin of error: +/- 3%. Confidence level: 95%."
  )

print(methodology)
```

```{r}
methodology %>% preview()
```

### Multi-Section Page

Combining multiple content collections on one page.

```{r}
# Create separate sections
intro <- create_content() %>%
  add_text("## Overview", "", "This page combines multiple content sections.")

demographics <- create_content(type = "bar") %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "Demographics")

attitudes <- create_content(type = "bar") %>%
  add_viz(x_var = "happy", title = "Happiness", tabgroup = "Attitudes")

# Combine into one page
multi_section <- create_page("Full Analysis", data = gss) %>%
  add_content(intro) %>%
  add_content(demographics) %>%
  add_content(attitudes)

print(multi_section)
```

```{r}
multi_section %>% preview()
```

## Page Settings Gallery

All configurable page options demonstrated.

### Loading Overlay Options

Show loading spinners while content renders.

```{r}
overlay_themes <- list(
  glass = "glass",
  light = "light", 
  dark = "dark",
  accent = "accent"
)

# Example with glass overlay
glass_page <- create_page(
  "Glass Overlay",
  data = gss,
  type = "bar",
  overlay = TRUE,
  overlay_theme = "glass",
  overlay_text = "Loading visualizations...",
  overlay_duration = 1500
) %>%
  add_viz(x_var = "degree", title = "Education")

print(glass_page)
```

### Lazy Loading

Load content on-demand for better performance.
```{r}
lazy_page <- create_page(
  "Lazy Loaded",
  data = gss,
  type = "bar",
  lazy_load_charts = TRUE,
  lazy_load_margin = "200px",
  lazy_load_tabs = TRUE
) %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "A") %>%
  add_viz(x_var = "race", title = "Race", tabgroup = "B") %>%
  add_viz(x_var = "happy", title = "Happiness", tabgroup = "C")

print(lazy_page)
```

### Navbar Alignment

Position pages on left or right of navigation bar.

```{r}
right_aligned <- create_page("Settings", navbar_align = "right") %>%
  add_text("This page appears on the right side of the navbar.")

print(right_aligned)
```

### Page Icons

Add icons to page names in navigation.

```{r}
icon_page <- create_page("Charts", icon = "ph:chart-bar-fill") %>%
  add_text("This page has a bar chart icon in the navbar.")

print(icon_page)
```

Available icon sets:
- **Phosphor**: `ph:icon-name` (recommended)
- **Material**: `mdi:icon-name`
- **Font Awesome**: `fa:icon-name`

### Tab Styling Options

Customize tab appearance per page.

```{r}
styled_tabs <- create_page(
  "Styled Tabs",
  data = gss,
  type = "bar",
  tabset_theme = "pills",
  tabset_colors = list(
    active_bg = "#E74C3C",
    active_text = "#FFFFFF",
    inactive_bg = "#ECF0F1",
    inactive_text = "#7F8C8D"
  )
) %>%
  add_viz(x_var = "degree", title = "Education", tabgroup = "A") %>%
  add_viz(x_var = "race", title = "Race", tabgroup = "B")

print(styled_tabs)
```

## Page Content Patterns Gallery

Common content organization patterns.

### Mixed Content Page

Visualizations with explanatory text.

```{r}
mixed_page <- create_page("Mixed Content", data = gss, type = "bar") %>%
  add_text(
    "## Survey Results",
    "",
    "Below are the key findings from our analysis."
  ) %>%
  add_viz(x_var = "degree", title = "Education Levels") %>%
  add_callout("Note: Data filtered to 2010-2024", type = "note") %>%
  add_text("### Interpretation", "", "Education levels show expected distribution patterns.")

print(mixed_page)
```

```{r}
mixed_page %>% preview()
```

### Comparison Page

Side-by-side filtered views.

```{r}
comparison_page <- create_page("Gender Comparison", data = gss, type = "bar") %>%
  add_text("## Happiness by Gender") %>%
  add_viz(x_var = "happy", title = "Male", filter = ~ sex == 1, tabgroup = "By Gender") %>%
  add_viz(x_var = "happy", title = "Female", filter = ~ sex == 2, tabgroup = "By Gender")

print(comparison_page)
```

```{r}
comparison_page %>% preview()
```

### Dashboard-Style Page

Metrics at top, charts below.

```{r}
dashboard_content <- create_content(data = gss, type = "bar") %>%
  add_value_box_row() %>%
    add_value_box(title = "Respondents", value = "21,788", bg_color = "#3498DB") %>%
    add_value_box(title = "Years", value = "15", bg_color = "#27AE60") %>%
    add_value_box(title = "Variables", value = "8", bg_color = "#9B59B6") %>%
  end_value_box_row() %>%
  add_divider() %>%
  add_viz(x_var = "degree", title = "Education Distribution")

dashboard_page <- create_page("Dashboard") %>%
  add_content(dashboard_content)

print(dashboard_page)
```

```{r}
dashboard_page %>% preview()
```

### Research Report Page

Academic-style with methodology section.

```{r}
research_content <- create_content() %>%
  add_text(
    "## Abstract",
    "",
    "This study examines happiness levels across educational attainment groups.",
    "",
    "## Introduction",
    "",
    "Understanding the relationship between education and subjective well-being",
    "is critical for policy development."
  ) %>%
  add_accordion(
    title = "Methodology Details",
    text = "Sample: N=21,788. Method: Cross-sectional survey analysis."
  ) %>%
  add_quote(
    quote = "Education is the most powerful weapon which you can use to change the world.",
    attribution = "Nelson Mandela"
  )

research_page <- create_page("Research Report") %>%
  add_content(research_content)

print(research_page)
```

```{r}
research_page %>% preview()
```

## Next Steps

Once you have pages, add them to a dashboard:

```r
create_dashboard(title = "GSS Explorer", output_dir = "output") %>%
  add_pages(home, analysis, about) %>%
  generate_dashboard(render = TRUE)
```

See `vignette("dashboards")` for dashboard creation details.
