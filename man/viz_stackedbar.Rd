% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/viz_stackedbar.R
\name{viz_stackedbar}
\alias{viz_stackedbar}
\title{Create a Stacked Bar Chart}
\usage{
viz_stackedbar(
  data,
  x_var = NULL,
  y_var = NULL,
  stack_var = NULL,
  x_vars = NULL,
  x_var_labels = NULL,
  response_levels = NULL,
  show_var_tooltip = TRUE,
  title = NULL,
  subtitle = NULL,
  x_label = NULL,
  y_label = NULL,
  stack_label = NULL,
  stacked_type = c("counts", "percent", "normal"),
  tooltip = NULL,
  tooltip_prefix = "",
  tooltip_suffix = "",
  x_tooltip_suffix = "",
  color_palette = NULL,
  stack_order = NULL,
  x_order = NULL,
  include_na = FALSE,
  na_label_x = "(Missing)",
  na_label_stack = "(Missing)",
  x_breaks = NULL,
  x_bin_labels = NULL,
  x_map_values = NULL,
  stack_breaks = NULL,
  stack_bin_labels = NULL,
  stack_map_values = NULL,
  horizontal = FALSE,
  weight_var = NULL,
  data_labels_enabled = TRUE,
  label_decimals = NULL,
  cross_tab_filter_vars = NULL,
  title_map = NULL,
  backend = "highcharter"
)
}
\arguments{
\item{data}{A data frame containing the survey data.}

\item{x_var}{String. Name of the column for X-axis categories (Mode 1: Grouped/Crosstab).
Use this together with \code{stack_var} for crosstab-style charts.}

\item{y_var}{Optional string. Name of a pre-computed count column. If NULL
(default), the function counts occurrences.}

\item{stack_var}{String. Name of the column whose values define the stacks.
Required when using \code{x_var}.}

\item{x_vars}{Character vector of column names to compare (Mode 2: Multi-Variable/Battery).
Each column becomes a bar on the x-axis, and the values within each column become the stacks.
Use this for comparing multiple survey questions with the same response scale.}

\item{x_var_labels}{Optional character vector of display labels for the variables.
Must be the same length as \code{x_vars}. If NULL, column names are used.}

\item{response_levels}{Optional character vector of factor levels for the
response categories (e.g., \code{c("Strongly Disagree", ..., "Strongly Agree")}).
This sets the order of the stacks in multi-variable mode.}

\item{show_var_tooltip}{Logical. If TRUE (default), shows enhanced tooltips
with variable labels in multi-variable mode.}

\item{title}{Optional string. Main chart title.}

\item{subtitle}{Optional string. Chart subtitle.}

\item{x_label}{Optional string. X-axis label. Defaults to empty in crosstab mode
or "Variable" in multi-variable mode.}

\item{y_label}{Optional string. Y-axis label. Defaults to "Count" or "Percentage".}

\item{stack_label}{Optional string. Title for the stack legend.
Set to NULL, NA, FALSE, or "" to hide the legend title.}

\item{stacked_type}{One of "normal", "counts" (both show raw counts), or
"percent" (100\% stacked). Defaults to "counts".}

\item{tooltip}{A tooltip configuration created with \code{\link{tooltip}()},
OR a format string with \{placeholders\}. Available placeholders:
\code{\{category\}}, \code{\{value\}}, \code{\{series\}}, \code{\{percent\}}.}

\item{tooltip_prefix}{Optional string prepended to tooltip values.}

\item{tooltip_suffix}{Optional string appended to tooltip values.}

\item{x_tooltip_suffix}{Optional string appended to x-axis values in tooltips.}

\item{color_palette}{Optional character vector of colors for the stacks.}

\item{stack_order}{Optional character vector specifying order of stack levels.}

\item{x_order}{Optional character vector specifying order of x-axis levels.}

\item{include_na}{Logical. If TRUE, NA values are shown as explicit categories.
If FALSE (default), rows with NA are excluded.}

\item{na_label_x}{String. Label for NA values on x-axis. Default "(Missing)".}

\item{na_label_stack}{String. Label for NA values in stacks. Default "(Missing)".}

\item{x_breaks}{Optional numeric vector of cut points for binning \code{x_var}.}

\item{x_bin_labels}{Optional character vector of labels for \code{x_breaks} bins.}

\item{x_map_values}{Optional named list to remap x-axis values for display.}

\item{stack_breaks}{Optional numeric vector of cut points for binning stack variable.}

\item{stack_bin_labels}{Optional character vector of labels for \code{stack_breaks} bins.}

\item{stack_map_values}{Optional named list to remap stack values for display.}

\item{horizontal}{Logical. If TRUE, creates horizontal bars. Default FALSE.}

\item{weight_var}{Optional string. Name of a weight variable for weighted counts.}

\item{data_labels_enabled}{Logical. If TRUE, show value labels on bars. Default TRUE.}

\item{label_decimals}{Optional integer. Number of decimal places for data labels.
When NULL (default), uses smart defaults: 0 for counts, 1 for percent.
Set explicitly to override (e.g., \code{label_decimals = 2}).}

\item{cross_tab_filter_vars}{Character vector. Variables for cross-tab filtering
(typically auto-detected from sidebar inputs).}

\item{title_map}{Named list mapping variable names to custom display titles
for dynamic title updates when filtering by cross-tab variables.}

\item{backend}{Rendering backend: "highcharter" (default), "plotly", "echarts4r", or "ggiraph".}
}
\value{
An interactive \code{highcharter} bar chart plot object.
}
\description{
A unified function for creating stacked bar charts that supports two modes:

\strong{Mode 1: Grouped/Crosstab Mode} (use \code{x_var} + \code{stack_var})

Creates a stacked bar chart from long/tidy data where one column provides
the x-axis categories and another column provides the stack segments.
This is ideal for cross-tabulating responses by demographic groups.

\strong{Mode 2: Multi-Variable/Battery Mode} (use \code{x_vars})

Creates a stacked bar chart from wide data where multiple columns become
the x-axis bars, and their values become the stacks. This is ideal for
comparing response distributions across multiple survey questions.

The function automatically detects which mode to use based on the parameters
provided.
}
\details{
\strong{Choosing the Right Mode:}

Use \strong{Mode 1} (\code{x_var} + \code{stack_var}) when you want to:
\itemize{
\item Show how one variable breaks down by another (e.g., education by gender)
\item Create a cross-tabulation visualization
\item Your data is already in long/tidy format
}

Use \strong{Mode 2} (\code{x_vars}) when you want to:
\itemize{
\item Compare response distributions across multiple survey questions
\item Visualize a Likert scale battery
\item Your questions share the same response categories
\item Your data is in wide format (one column per question)
}

\strong{Data Handling Features:}
\itemize{
\item Automatically handles \code{haven_labelled} columns from SPSS/Stata/SAS
\item Supports value mapping to rename categories for display
\item Supports binning of continuous variables
\item Handles missing values explicitly or implicitly
}
}
\examples{
\dontrun{
library(gssr)
data(gss_panel20)

# MODE 1: Grouped/Crosstab - One variable broken down by another

# Example 1: Education by Gender (counts)
plot1 <- viz_stackedbar(
  data = gss_panel20,
  x_var = "degree_1a",
  stack_var = "sex_1a",
  title = "Educational Attainment by Gender",
  x_label = "Highest Degree",
  stack_label = "Gender"
)

# Example 2: Happiness by Education (percentages)
plot2 <- viz_stackedbar(
  data = gss_panel20,
  x_var = "degree_1a",
  stack_var = "happy_1a",
  title = "Happiness by Education Level",
  stacked_type = "percent",
  tooltip_suffix = "\%"
)

# MODE 2: Multi-Variable/Battery - Compare multiple questions

# Example 3: Compare multiple attitude questions
plot3 <- viz_stackedbar(
  data = gss_panel20,
  x_vars = c("trust_1a", "fair_1a", "helpful_1a"),
  x_var_labels = c("Trust Others", "Others Are Fair",
    "Others Are Helpful"),
  title = "Social Trust Battery",
  stacked_type = "percent",
  tooltip_suffix = "\%"
)

# Example 4: Single question horizontal (compact display)
plot4 <- viz_stackedbar(
  data = gss_panel20,
  x_vars = "happy_1a",
  title = "General Happiness",
  stacked_type = "percent",
  horizontal = TRUE
)
}

}
\seealso{
\code{\link{viz_bar}} for simple (non-stacked) bar charts
}
