% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/viz_heatmap.R
\name{viz_heatmap}
\alias{viz_heatmap}
\title{Create a Heatmap}
\usage{
viz_heatmap(
  data,
  x_var,
  y_var,
  value_var,
  title = NULL,
  subtitle = NULL,
  x_label = NULL,
  y_label = NULL,
  value_label = NULL,
  tooltip = NULL,
  tooltip_prefix = "",
  tooltip_suffix = "",
  x_tooltip_suffix = "",
  y_tooltip_suffix = "",
  x_tooltip_prefix = "",
  y_tooltip_prefix = "",
  x_order = NULL,
  y_order = NULL,
  x_order_by = NULL,
  y_order_by = NULL,
  color_min = NULL,
  color_max = NULL,
  color_palette = c("#FFFFFF", "#7CB5EC"),
  na_color = "transparent",
  data_labels_enabled = TRUE,
  label_decimals = 1,
  tooltip_labels_format = NULL,
  include_na = FALSE,
  na_label_x = "(Missing)",
  na_label_y = "(Missing)",
  x_map_values = NULL,
  y_map_values = NULL,
  agg_fun = mean,
  weight_var = NULL,
  pre_aggregated = FALSE
)
}
\arguments{
\item{data}{A data frame containing the variables to plot.}

\item{x_var}{String. Name of the column for the X-axis categories.}

\item{y_var}{String. Name of the column for the Y-axis categories.}

\item{value_var}{String. Name of the numeric column whose values will
determine the color intensity.}

\item{title}{Optional string. Main chart title.}

\item{subtitle}{Optional string. Chart subtitle.}

\item{x_label}{Optional string. X-axis label. Defaults to \code{x_var}.}

\item{y_label}{Optional string. Y-axis label. Defaults to \code{y_var}.}

\item{value_label}{Optional string. Label for the color axis. Defaults to \code{value_var}.}

\item{tooltip}{A tooltip configuration created with \code{\link{tooltip}()},
OR a format string with \{placeholders\}. Available placeholders:
\code{\{x\}}, \code{\{y\}}, \code{\{value\}}, \code{\{name\}}.
See \code{\link{tooltip}} for full customization options.}

\item{tooltip_prefix}{Optional string prepended in the tooltip value (simple customization).}

\item{tooltip_suffix}{Optional string appended in the tooltip value (simple customization).}

\item{x_tooltip_suffix}{Optional string appended to x value in tooltip.}

\item{y_tooltip_suffix}{Optional string appended to y value in tooltip.}

\item{x_tooltip_prefix}{Optional string prepended to x value in tooltip.}

\item{y_tooltip_prefix}{Optional string prepended to y value in tooltip.}

\item{x_order}{Optional character vector to order the factor levels of \code{x_var}.
Alternatively, use \code{x_order_by} to order by aggregated values.}

\item{y_order}{Optional character vector to order the factor levels of \code{y_var}.
Alternatively, use \code{y_order_by} to order by aggregated values.}

\item{x_order_by}{Optional. Order x-axis categories by aggregated value.
Can be "asc" (ascending), "desc" (descending), or NULL (default, no reordering).
When set, categories are sorted by their mean value across all y categories.}

\item{y_order_by}{Optional. Order y-axis categories by aggregated value.
Can be "asc" (ascending), "desc" (descending), or NULL (default, no reordering).
When set, categories are sorted by their mean value across all x categories.}

\item{color_min}{Optional numeric. Minimum value for the color axis. If NULL, defaults to data min.}

\item{color_max}{Optional numeric. Maximum value for the color axis. If NULL, defaults to data max.}

\item{color_palette}{Optional character vector of colors for the color gradient.
Example: \code{c("#FFFFFF", "#7CB5EC")} for white to light blue. Can also be a single color for gradient start.}

\item{na_color}{Optional string. Color for NA values in \code{value_var} cells. Default "transparent".}

\item{data_labels_enabled}{Logical. If TRUE, display data labels on each cell. Default TRUE.}

\item{label_decimals}{Integer. Number of decimal places for data labels and tooltips.
Default is 1. Set to 0 for whole numbers, 2 for two decimal places, etc.
Ignored if \code{tooltip_labels_format} is explicitly provided.}

\item{tooltip_labels_format}{Optional string. Format for data labels. Default NULL
(auto-generated from \code{label_decimals}). If provided, overrides \code{label_decimals}.}

\item{include_na}{Logical. If TRUE, treats NA values in \code{x_var} or \code{y_var}
as explicit categories using \code{na_label_x} and \code{na_label_y}. If FALSE (default),
rows with NA in \code{x_var} or \code{y_var} are excluded from aggregation.}

\item{na_label_x}{Optional string. Custom label for NA values in \code{x_var}. Defaults to "(Missing)".}

\item{na_label_y}{Optional string. Custom label for NA values in \code{y_var}. Defaults to "(Missing)".}

\item{x_map_values}{Optional named list to recode x_var values for display.}

\item{y_map_values}{Optional named list to recode y_var values for display.}

\item{agg_fun}{Function to aggregate duplicate x/y combinations. Default is \code{mean}.
Note: If \code{weight_var} is provided, weighted mean is used instead and this parameter is ignored.}

\item{weight_var}{Optional string. Name of a weight variable to use for weighted mean aggregation.
When provided, the function uses \code{weighted.mean()} instead of the \code{agg_fun} parameter.}

\item{pre_aggregated}{Logical. If TRUE, skips aggregation and uses \code{value_var} directly.
Use this when your data is already aggregated (one row per x/y combination).
Default is FALSE.}
}
\value{
A \code{highcharter} heatmap object.
}
\description{
This function creates a heatmap for bivariate data, visualizing
the relationship between two categorical variables and a numeric value
using color intensity. It handles ordered factors, ensures all combinations
are plotted, and allows for extensive customization. It also includes
robust handling of missing values (NA) by allowing them to be displayed
as explicit categories.
}
\details{
This function performs the following steps:
\enumerate{
\item \strong{Input validation:} Checks \code{data}, \code{x_var}, \code{y_var}, and \code{value_var}.
\item \strong{Data Preparation:}
\itemize{
\item Handles \code{haven_labelled} columns by converting them to factors.
\item Applies value mapping if \code{x_map_values} or \code{y_map_values} (new parameter) are provided.
\item Processes NA values in \code{x_var} and \code{y_var}: if \code{include_na = TRUE}, NAs are converted to a specified label; otherwise, rows with NAs in these variables are filtered out.
\item Converts \code{x_var} and \code{y_var} to factors and applies \code{x_order} and \code{y_order}.
\item If \code{weight_var} is provided, uses \code{weighted.mean()} for aggregation; otherwise uses \code{agg_fun} (default \code{mean()}).
\item Uses \code{tidyr::complete} to ensure all \code{x_var}/\code{y_var} combinations are present,
filling missing \code{value_var} with \code{NA_real_} (which will appear as \code{na_color} in the heatmap).
}
\item \strong{Chart Construction:}
\itemize{
\item Initializes a \code{highchart} object.
\item Configures \code{title}, \code{subtitle}, axis labels.
\item Sets up \code{hc_colorAxis} based on \code{color_min}, \code{color_max}, and \code{color_palette}.
\item Adds the heatmap series using \code{hc_add_series}, mapping \code{x_var}, \code{y_var}, and \code{value_var}.
\item Customizes \code{plotOptions} for heatmap, including data labels and \code{nullColor}.
}
\item \strong{Tooltip Customization:} Defines a JavaScript \code{tooltip.formatter} for detailed hover information.
}
}
\examples{
\dontrun{
# Load the dataset
data(gss_panel20)

# Example 1: Basic heatmap - no mapped values or other customization
viz_heatmap(
  data = gss_panel20,
  x_var = "degree_1a",
  y_var = "sex_1a",
  value_var = "age_1a",
  title = "Average Age by Education and Sex",
  x_label = "Education Level",
  y_label = "Sex",
  value_label = "Mean Age"
)


# Example 2: Heatmap With Custom Variable Mapping and Colors

region_map <- list("1" = "New England",
"2" = "Mid-Atlantic",
"3" = "East North Central",
"4" = "West North Central",
"5" = "South Atlantic",
"6" = "Deep South",
"7" = "West South Central",
"8" = "Mountain",
"9" = "West Coast"
)
sex_map <- list("1" = "Male",
               "2" = "Female")

viz_heatmap(
  data = gss_panel20,
  x_var = "region_1a",
  y_var = "sex_1a",
  value_var = "satfin_1a",
  x_map_values = region_map,
  y_map_values = sex_map,
  value_label = "Satisfaction",
  x_label = "U.S. Region",
  y_label = "Gender",
  title = "Satisfaction with Financial Situation",
  subtitle = "Per U.S. Region and Gender",
  color_palette = c("#f7fbff", "darkgreen"),
  color_min = 1,
  color_max = 3
)


# Example 3: Handling missing categories explicitly

edu_map = list("0" = "less than high school",
"1" =  "high school",
"2" = "associate/junior college",
"3" = "bachelor's",
"4" = "graduate")

viz_heatmap(
data = gss_panel20,
x_var = "region_1a",
y_var = "degree_1a",
value_var = "income_1a",
x_map_values = region_map,
y_map_values = edu_map,
color_min = 8,
color_max = 12,
value_label = "Income",
x_label = "U.S. Region",
y_label = "Education",
include_na = TRUE,
na_label_x = "Region Missing",
na_label_y = "Degree Missing",
na_color = "grey",
title = "Average Income by Region and Education (Including Missing)"
)


# Example 4: Custom order of education levels and relabeling of sex
viz_heatmap(
data = gss_panel20,
x_var = "degree_1a",
y_var = "sex_1a",
value_var = "income_1a",
x_map_values = edu_map,
x_order = c("less than high school", "high school", "associate/junior college",
"bachelor's", "graduate"),
y_map_values = sex_map,
y_label = "Gender",
x_label = "Education Level",
value_label = "Income Level",
title = "Average Income by Education Level and Sex",
subtitle = "Custom order and relabeled categories",
color_palette = c("#ffffe0", "#31a354")
)
}

}
