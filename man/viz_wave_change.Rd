% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dashboard.R
\name{viz_wave_change}
\alias{viz_wave_change}
\title{Visualize Changes Across Waves for Multiple Variables}
\usage{
viz_wave_change(
  vars,
  var_labels,
  categories_dat,
  wavevar,
  range1 = 1:2,
  range2 = 3,
  range3 = 4:5,
  weight_var = NULL
)
}
\arguments{
\item{vars}{A character vector of variable names from the global \code{data} object to be analyzed.}

\item{var_labels}{A character vector of labels corresponding to the \code{vars}.
These labels will be used as chart titles.}

\item{categories_dat}{A character vector of exactly three category labels.
The recoded data will be grouped into these three categories.
Example: \code{c("Positive", "Neutral", "Negative")}.}

\item{wavevar}{A character string specifying the name of the column in \code{data}
that identifies the different waves (e.g., "survey_round").}

\item{range1}{A numeric vector defining the raw values to be recoded into \code{categories_dat[3]} (the third category).
Defaults to \code{1:2}.}

\item{range2}{A numeric vector defining the raw values to be recoded into \code{categories_dat[2]} (the second category).
Defaults to \code{3}.}

\item{range3}{A numeric vector defining the raw values to be recoded into \code{categories_dat[1]} (the first category).
Defaults to \code{4:5}.}

\item{weight_var}{An optional character string specifying the name of the column in \code{data}
to be used for weighting. If \code{NULL} (default), data will not be weighted.}
}
\value{
A list of \code{highchart} objects. Each element in the list is a line chart
for one of the input variables, showing trends across waves.
}
\description{
This function generates a series of line charts, one for each specified
variable, showing how the distribution of responses across three
predefined categories changes over different waves (e.g., survey waves).
It supports weighted data.
}
\details{
The function performs the following main steps:
\enumerate{
\item \strong{Data Preparation}: Selects the specified variables (\code{vars}), the wave variable (\code{wavevar}),
and an optional weight variable (\code{weight_var}) from the global \code{data} object.
It removes rows with missing values in these selected columns and renames them
using \code{var_labels} (for variables), "wave", and "weight".
\item \strong{Data Transformation}:
\itemize{
\item Pivots the data from a wide to a long format.
\item Recodes the values of each variable into three categories based on the \code{range1},
\code{range2}, and \code{range3} arguments, assigning them labels from \code{categories_dat}.
The mapping is: \code{range1} -> \code{categories_dat[3]}, \code{range2} -> \code{categories_dat[2]},
\code{range3} -> \code{categories_dat[1]}.
\item Converts the recoded categories into an ordered factor based on \code{categories_dat}.
\item Counts the (optionally weighted) occurrences of each category for each variable within each wave.
\item Calculates the percentage of each category within each variable and wave.
}
\item \strong{Variable Ordering}: Determines the plotting order of the variables. Variables are
ordered based on the descending percentage of the third category (\code{categories_dat[3]})
in the latest available wave.
\item \strong{Plotting}: For each variable (in the determined order), it generates a line chart
using \code{highcharter}. Each chart displays:
\itemize{
\item Trends for the three categories over the waves.
\item A title corresponding to the variable label.
\item Custom colors (from a globally defined \code{colors} object).
\item Configured X and Y axes, tooltips, data labels on lines, legend, and a caption
showing the total number of observations (\code{N}) after initial NA removal.
\item Exporting options (using a globally defined \code{myMenuItems} object).
}
}
}
\examples{
# Assume 'data' is a data frame in the global environment with columns:
# 'q1', 'q2' (numeric, e.g., 1-5 scale)
# 'survey_round' (e.g., 1, 2, 3 indicating waves)
# 'sample_weights' (optional numeric weights)

# Assume 'colors' and 'myMenuItems' are defined globally for highcharter styling.
# colors <- c("#007bff", "#28a745", "#dc3545")
# myMenuItems <- c("downloadPNG", "downloadJPEG", "downloadSVG")

# example_vars <- c("q1", "q2")
# example_var_labels <- c("Question 1: Satisfaction", "Question 2: Agreement")
# example_categories <- c("High (4-5)", "Mid (3)", "Low (1-2)")

# wave_plots <- viz_wave_change(
#   vars = example_vars,
#   var_labels = example_var_labels,
#   categories_dat = example_categories,
#   wavevar = "survey_round",
#   range1 = 1:2, # Maps to example_categories[3] "Low (1-2)"
#   range2 = 3,   # Maps to example_categories[2] "Mid (3)"
#   range3 = 4:5, # Maps to example_categories[1] "High (4-5)"
#   weight_var = "sample_weights"
# )

# To display the first plot:
# if (length(wave_plots) > 0) {
#   wave_plots[[1]]
# }

Dependencies: dplyr, tidyr, highcharter, forcats, purrr
              (Assumes `data`, `colors`, and `myMenuItems` are available in the global environment.)
}
