---
title: "{{< iconify ph chart-bar >}} Political Attitudes"
format: html
---

```{r, include=FALSE}
# Initialize dashboardr page configuration (CSS/JS for charts)
dashboardr:::.page_config()
```

Party identification and ideological views across different groups.

```{r setup}
#| echo: false
#| warning: false
#| message: false
#| error: false
#| results: 'hide'

# Load dashboardr (includes dplyr, highcharter as dependencies)
library(dashboardr)

# Global chunk options
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 8,
  dpi = 300
)

# Load data
data <- readRDS('dataset_2849obs.rds')

# Data summary
cat('Dataset loaded:', nrow(data), 'rows,', ncol(data), 'columns\n')

```

## Party Identification by Political Ideology

```{r stackedbar-polviews-partyid}
# Party Identification by Political Ideology
result <- viz_stackedbar(
  data = data,
  title = "Party Identification by Political Ideology",
  x_var = "polviews",
  stack_var = "partyid",
  subtitle = "How party affiliation aligns with self-reported ideology",
  x_label = "Political Views",
  y_label = "Percentage",
  stack_label = "Party ID",
  stacked_type = "percent",
  color_palette = c("#2166ac", "#67a9cf", "#d1e5f0", "#f7f7f7", "#fddbc7", "#ef8a62", "#b2182b")
)

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 500)
}
result <- htmltools::div(
  style = 'height: 500px !important; min-height: 500px !important; width: 100%; overflow: visible;',
  result
)

result
```

## Mean Age by Ideology and Social Class

```{r heatmap-polviews-class}
# Mean Age by Ideology and Social Class
result <- viz_heatmap(
  data = data,
  title = "Mean Age by Ideology and Social Class",
  x_var = "polviews",
  y_var = "class",
  value_var = "age",
  subtitle = "Demographic patterns across political and class lines",
  x_label = "Political Views",
  y_label = "Social Class",
  value_label = "Mean Age",
  y_order = c("Lower Class", "Working Class", "Middle Class", "Upper Class"),
  color_palette = c("#f7fbff", "#c6dbef", "#6baed6", "#2171b5", "#08306b")
)

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 450)
}
result <- htmltools::div(
  style = 'height: 450px !important; min-height: 450px !important; width: 100%; overflow: visible;',
  result
)

result
```

## Social Class by Gender

```{r bar-class-sex}
# Social Class by Gender
result <- viz_bar(
  data = data,
  title = "Social Class by Gender",
  x_var = "class",
  group_var = "sex",
  subtitle = "Self-reported social class distribution",
  x_label = "Social Class",
  y_label = "Count",
  x_order = c("Lower Class", "Working Class", "Middle Class", "Upper Class"),
  color_palette = c("#3498db", "#e74c3c")
)

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 400)
}
result <- htmltools::div(
  style = 'height: 400px !important; min-height: 400px !important; width: 100%; overflow: visible;',
  result
)

result
```

