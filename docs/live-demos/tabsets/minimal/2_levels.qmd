---
title: "{{< iconify ph stack >}} 2 Levels"
format: html
---

```{r, include=FALSE}
# Initialize dashboardr page configuration (CSS/JS for charts)
dashboardr:::.page_config()
```

## Two Level Nested Tabs

Use `/` to create parent and child tabs:

```r
add_viz(..., tabgroup = "satisfaction/by_age") %>%
add_viz(..., tabgroup = "satisfaction/by_education") %>%
add_viz(..., tabgroup = "education/by_age")
```

```{r setup}
#| echo: false
#| warning: false
#| message: false
#| error: false
#| results: 'hide'

# Load dashboardr (includes dplyr, highcharter as dependencies)
library(dashboardr)

# Global chunk options
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 8,
  dpi = 300
)

# Load data
data <- readRDS('dataset_2000obs.rds')

# Data summary
cat('Dataset loaded:', nrow(data), 'rows,', ncol(data), 'columns\n')

```


::: {.panel-tabset}

### Satisfaction Analysis


::: {.panel-tabset}

##### By Age


```{r satisfaction-by-age}
# Satisfaction by Age
result <- viz_stackedbar(
  data = data,
  title = "Satisfaction by Age",
  x_var = "age_group",
  stack_var = "satisfaction",
  x_label = "Age Group",
  y_label = "Percentage",
  stack_label = "Satisfaction",
  stacked_type = "percent",
  x_order = c("18-29", "30-44", "45-59", "60+"),
  stack_order = c("Very Satisfied", "Satisfied", "Neutral", "Dissatisfied"),
  color_palette = c("#22C55E", "#84CC16", "#EAB308", "#EF4444"),
  tooltip_suffix = "%"
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 480)
}
result <- htmltools::div(
  style = 'height: 480px !important; min-height: 480px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


##### By Education


```{r satisfaction-by-education}
# Satisfaction by Education
result <- viz_stackedbar(
  data = data,
  title = "Satisfaction by Education",
  x_var = "education",
  stack_var = "satisfaction",
  x_label = "Education",
  y_label = "Percentage",
  stack_label = "Satisfaction",
  stacked_type = "percent",
  x_order = c("High School", "Bachelor's", "Graduate"),
  stack_order = c("Very Satisfied", "Satisfied", "Neutral", "Dissatisfied"),
  color_palette = c("#22C55E", "#84CC16", "#EAB308", "#EF4444"),
  tooltip_suffix = "%"
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 480)
}
result <- htmltools::div(
  style = 'height: 480px !important; min-height: 480px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


##### By Region


```{r satisfaction-by-region}
# Satisfaction by Region
result <- viz_stackedbar(
  data = data,
  title = "Satisfaction by Region",
  x_var = "region",
  stack_var = "satisfaction",
  x_label = "Region",
  y_label = "Percentage",
  stack_label = "Satisfaction",
  stacked_type = "percent",
  x_order = c("North", "South", "East", "West"),
  stack_order = c("Very Satisfied", "Satisfied", "Neutral", "Dissatisfied"),
  color_palette = c("#22C55E", "#84CC16", "#EAB308", "#EF4444"),
  tooltip_suffix = "%",
  horizontal = TRUE
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 480)
}
result <- htmltools::div(
  style = 'height: 480px !important; min-height: 480px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


:::


### Education Analysis


::: {.panel-tabset}

##### By Age


```{r education-by-age}
# Education by Age Group
result <- viz_stackedbar(
  data = data,
  title = "Education by Age Group",
  x_var = "age_group",
  stack_var = "education",
  x_label = "Age Group",
  y_label = "Percentage",
  stack_label = "Education",
  stacked_type = "percent",
  x_order = c("18-29", "30-44", "45-59", "60+"),
  stack_order = c("High School", "Bachelor's", "Graduate"),
  color_palette = c("#06B6D4", "#8B5CF6", "#F43F5E"),
  tooltip_suffix = "%"
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 480)
}
result <- htmltools::div(
  style = 'height: 480px !important; min-height: 480px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


##### By Region


```{r education-by-region}
# Education by Region
result <- viz_stackedbar(
  data = data,
  title = "Education by Region",
  x_var = "region",
  stack_var = "education",
  x_label = "Region",
  y_label = "Percentage",
  stack_label = "Education",
  stacked_type = "percent",
  x_order = c("North", "South", "East", "West"),
  stack_order = c("High School", "Bachelor's", "Graduate"),
  color_palette = c("#06B6D4", "#8B5CF6", "#F43F5E"),
  tooltip_suffix = "%",
  horizontal = TRUE
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 480)
}
result <- htmltools::div(
  style = 'height: 480px !important; min-height: 480px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


:::


:::

