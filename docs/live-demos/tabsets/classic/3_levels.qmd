---
title: "{{< iconify ph tree-structure >}} 3 Levels"
format: html
---

```{r, include=FALSE}
# Initialize dashboardr page configuration (CSS/JS for charts)
dashboardr::.page_config()
```

## Three Level Nested Tabs

Add more `/` for deeper nesting:

```r
add_viz(..., tabgroup = "survey/satisfaction/age") %>%
add_viz(..., tabgroup = "survey/demographics/education") %>%
add_viz(..., tabgroup = "analysis/trends/regional")
```

```{r setup}
#| echo: false
#| warning: false
#| message: false
#| error: false
#| results: 'hide'

# Load dashboardr (includes dplyr, highcharter as dependencies)
library(dashboardr)

# Global chunk options
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 8,
  dpi = 300
)

# Load data
data <- readRDS('dataset_2000obs.rds')

# Data summary
cat('Dataset loaded:', nrow(data), 'rows,', ncol(data), 'columns\n')

```

## Survey Results


::: {.panel-tabset}

### Satisfaction


::: {.panel-tabset}

##### By Age


```{r survey-satisfaction-age}
# Age Distribution
result <- viz_stackedbar(
  data = data,
  title = "Age Distribution",
  x_var = "age_group",
  stack_var = "satisfaction",
  x_label = "Age",
  y_label = "%",
  stack_label = "Satisfaction",
  stacked_type = "percent",
  x_order = c("18-29", "30-44", "45-59", "60+"),
  stack_order = c("Very Satisfied", "Satisfied", "Neutral", "Dissatisfied"),
  color_palette = c("#22C55E", "#84CC16", "#EAB308", "#EF4444"),
  tooltip_suffix = "%"
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


##### By Education


```{r survey-satisfaction-education}
# Education Distribution
result <- viz_stackedbar(
  data = data,
  title = "Education Distribution",
  x_var = "education",
  stack_var = "satisfaction",
  x_label = "Education",
  y_label = "%",
  stack_label = "Satisfaction",
  stacked_type = "percent",
  x_order = c("High School", "Bachelor's", "Graduate"),
  stack_order = c("Very Satisfied", "Satisfied", "Neutral", "Dissatisfied"),
  color_palette = c("#22C55E", "#84CC16", "#EAB308", "#EF4444"),
  tooltip_suffix = "%"
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


:::


### Demographics


::: {.panel-tabset}

##### By Age


```{r survey-demographics-age}
# Age by Region
result <- viz_stackedbar(
  data = data,
  title = "Age by Region",
  x_var = "age_group",
  stack_var = "region",
  x_label = "Age",
  y_label = "%",
  stack_label = "Region",
  stacked_type = "percent",
  x_order = c("18-29", "30-44", "45-59", "60+"),
  stack_order = c("North", "South", "East", "West"),
  color_palette = c("#3B82F6", "#8B5CF6", "#EC4899", "#F97316"),
  tooltip_suffix = "%"
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


##### By Education


```{r survey-demographics-education}
# Education by Region
result <- viz_stackedbar(
  data = data,
  title = "Education by Region",
  x_var = "education",
  stack_var = "region",
  x_label = "Education",
  y_label = "%",
  stack_label = "Region",
  stacked_type = "percent",
  x_order = c("High School", "Bachelor's", "Graduate"),
  stack_order = c("North", "South", "East", "West"),
  color_palette = c("#3B82F6", "#8B5CF6", "#EC4899", "#F97316"),
  tooltip_suffix = "%",
  horizontal = TRUE
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


:::


:::

## Analysis


::: {.panel-tabset}

### Trends


::: {.panel-tabset}

##### Regional


```{r analysis-trends-regional}
# Regional Age Distribution
result <- viz_stackedbar(
  data = data,
  title = "Regional Age Distribution",
  x_var = "region",
  stack_var = "age_group",
  x_label = "Region",
  y_label = "%",
  stack_label = "Age Group",
  stacked_type = "percent",
  x_order = c("North", "South", "East", "West"),
  stack_order = c("18-29", "30-44", "45-59", "60+"),
  color_palette = c("#3B82F6", "#10B981", "#F59E0B", "#EF4444"),
  tooltip_suffix = "%",
  horizontal = TRUE
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


##### Educational


```{r analysis-trends-educational}
# Educational Age Distribution
result <- viz_stackedbar(
  data = data,
  title = "Educational Age Distribution",
  x_var = "education",
  stack_var = "age_group",
  x_label = "Education",
  y_label = "%",
  stack_label = "Age Group",
  stacked_type = "percent",
  x_order = c("High School", "Bachelor's", "Graduate"),
  stack_order = c("18-29", "30-44", "45-59", "60+"),
  color_palette = c("#3B82F6", "#10B981", "#F59E0B", "#EF4444"),
  tooltip_suffix = "%"
)

# Set chart height
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 460)
}

# Force container height with explicit wrapper
result <- htmltools::div(
  style = 'height: 460px !important; min-height: 460px !important; width: 100%; overflow: visible;',
  result
)

result
```


:::


:::

