---
title: "{{< iconify ph chart-bar >}} Charts"
format: html
---

```{r, include=FALSE}
# Initialize dashboardr page configuration (CSS/JS for charts)
dashboardr:::.page_config()
```

```{r setup}
#| echo: false
#| warning: false
#| message: false
#| error: false
#| results: 'hide'

# Load dashboardr (includes dplyr, highcharter as dependencies)
library(dashboardr)

# Global chunk options
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.width = 12,
  fig.height = 8,
  dpi = 300
)

# Load data
data <- readRDS('dataset_2854obs.rds')

# Data summary
cat('Dataset loaded:', nrow(data), 'rows,', ncol(data), 'columns\n')

```


<details>
<summary>{{< iconify ph code >}} View Full Page Code</summary>

```r
# === CHARTS PAGE ===
# This page shows a bar chart and stacked bar chart

# Data preparation
library(gssr)
data(gss_panel20, package = "gssr")
gss_clean <- gss_panel20 %>%
  dplyr::mutate(
    degree = as.character(haven::as_factor(degree_1a)),
    happy = as.character(haven::as_factor(happy_1a))
  ) %>%
  dplyr::filter(!is.na(degree), !is.na(happy))

# Create visualizations
chart_vizzes <- create_content() %>%
  add_viz(type = "bar",
          x_var = "degree",
          title = "Education Level Distribution",
          subtitle = "Count of respondents by highest degree attained",
          x_label = "Education",
          y_label = "Count",
          x_order = c("less than high school", "high school",
                      "associate/junior college", "bachelor's", "graduate"),
          color_palette = c("#3498db", "#2ecc71", "#9b59b6", "#e74c3c", "#f39c12"),
          height = 400) %>%
  add_viz(type = "stackedbar",
          x_var = "degree",
          stack_var = "happy",
          title = "Happiness by Education Level",
          subtitle = "Self-reported happiness across education groups",
          x_label = "Education",
          y_label = "Percentage",
          stack_label = "Happiness",
          stacked_type = "percent",
          x_order = c("less than high school", "high school",
                      "associate/junior college", "bachelor's", "graduate"),
          stack_order = c("very happy", "pretty happy", "not too happy"),
          color_palette = c("#27ae60", "#f39c12", "#e74c3c"),
          height = 450)

# Create page and add content
charts_page <- create_page(name = "Charts", data = gss_clean, icon = "ph:chart-bar") %>%
  add_content(chart_vizzes)
```

</details>


This page demonstrates three common chart types: a **bar chart** for counts, and a **stacked bar chart** for proportions.

## Education Level Distribution

```{r bar-degree}
# Education Level Distribution
result <- viz_bar(
  data = data,
  title = "Education Level Distribution",
  x_var = "degree",
  subtitle = "Count of respondents by highest degree attained",
  x_label = "Education",
  y_label = "Count",
  x_order = c("less than high school", "high school", "associate/junior college", "bachelor's", "graduate"),
  color_palette = c("#3498db", "#2ecc71", "#9b59b6", "#e74c3c", "#f39c12")
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 400)
}
result <- htmltools::div(
  style = 'height: 400px !important; min-height: 400px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


<details>
<summary>{{< iconify ph code >}} View R Code</summary>

```r
add_viz(type = "bar",
        x_var = "degree",
        title = "Education Level Distribution",
        subtitle = "Count of respondents by highest degree attained",
        x_label = "Education",
        y_label = "Count",
        x_order = c("less than high school", "high school",
                    "associate/junior college", "bachelor's", "graduate"),
        color_palette = c("#3498db", "#2ecc71", "#9b59b6", "#e74c3c", "#f39c12"),
        height = 400)
```

</details>

## Happiness by Education Level

```{r stackedbar-degree-happy}
# Happiness by Education Level
result <- viz_stackedbar(
  data = data,
  title = "Happiness by Education Level",
  x_var = "degree",
  stack_var = "happy",
  subtitle = "Self-reported happiness across education groups",
  x_label = "Education",
  y_label = "Percentage",
  stack_label = "Happiness",
  stacked_type = "percent",
  x_order = c("less than high school", "high school", "associate/junior college", "bachelor's", "graduate"),
  stack_order = c("very happy", "pretty happy", "not too happy"),
  color_palette = c("#27ae60", "#f39c12", "#e74c3c")
)

# Extract cross-tab data BEFORE wrapping (wrapping strips attributes)
cross_tab_data <- attr(result, 'cross_tab_data')
cross_tab_config <- attr(result, 'cross_tab_config')
cross_tab_id <- attr(result, 'cross_tab_id')

# Force container height with explicit wrapper
if (inherits(result, 'highchart')) {
  result <- highcharter::hc_size(result, height = 450)
}
result <- htmltools::div(
  style = 'height: 450px !important; min-height: 450px !important; width: 100%; overflow: visible;',
  result
)

# Embed cross-tab data for client-side filtering
if (!is.null(cross_tab_data)) {
  cross_tab_json <- jsonlite::toJSON(cross_tab_data, dataframe = 'rows')
  config_json <- jsonlite::toJSON(cross_tab_config, auto_unbox = TRUE)
  script_tag <- htmltools::tags$script(
    htmltools::HTML(paste0(
      'window.dashboardrCrossTab = window.dashboardrCrossTab || {};',
      'window.dashboardrCrossTab["', cross_tab_id, '"] = {',
      'data: ', cross_tab_json, ',',
      'config: ', config_json,
      '};'
    ))
  )
  result <- htmltools::tagList(script_tag, result)
}

result
```


<details>
<summary>{{< iconify ph code >}} View R Code</summary>

```r
add_viz(type = "stackedbar",
        x_var = "degree",
        stack_var = "happy",
        title = "Happiness by Education Level",
        subtitle = "Self-reported happiness across education groups",
        x_label = "Education",
        y_label = "Percentage",
        stack_label = "Happiness",
        stacked_type = "percent",
        x_order = c("less than high school", "high school",
                    "associate/junior college", "bachelor's", "graduate"),
        stack_order = c("very happy", "pretty happy", "not too happy"),
        color_palette = c("#27ae60", "#f39c12", "#e74c3c"),
        height = 450)
```

</details>

