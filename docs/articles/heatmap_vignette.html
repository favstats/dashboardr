<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Interactive Heatmaps with `create_heatmap` • dashboardr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Interactive Heatmaps with `create_heatmap`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dashboardr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/heatmap_vignette.html">Creating Interactive Heatmaps with `create_heatmap`</a></li>
    <li><a class="dropdown-item" href="../articles/stackedbar_vignette.html">Creating Interactive Stacked Bar Charts with `create_stackedbar`</a></li>
    <li><a class="dropdown-item" href="../articles/stackedbars_vignette.html">Getting Started With `create_stackedbars()`</a></li>
    <li><a class="dropdown-item" href="../articles/timeline_vignette.html">Getting Started With `create_timeline()`</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="heatmap_vignette_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="heatmap_vignette_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="heatmap_vignette_files/proj4js-2.3.15/proj4.js"></script><link href="heatmap_vignette_files/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="heatmap_vignette_files/highcharts-9.3.1/highcharts.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/highcharts-3d.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/highcharts-more.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/stock.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/map.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/data.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/exporting.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/drilldown.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/item-series.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/annotations.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/export-data.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/funnel.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/heatmap.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/treemap.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/sankey.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/organization.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/streamgraph.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/sunburst.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/vector.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/wordcloud.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/xrange.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/tilemap.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/venn.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/gantt.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/timeline.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/bullet.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/coloraxis.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/dumbbell.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/lollipop.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/series-label.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/plugins/motion.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/custom/reset.js"></script><script src="heatmap_vignette_files/highcharts-9.3.1/modules/boost.js"></script><script src="heatmap_vignette_files/highchart-binding-0.9.4/highchart.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Creating Interactive Heatmaps with `create_heatmap`</h1>
                        <h4 data-toc-skip class="author">Alexandra
Pafford</h4>
            
            <h4 data-toc-skip class="date">2025-08-03</h4>
      

      <div class="d-none name"><code>heatmap_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Welcome to this guide on how to use the <code>create_heatmap</code>
function as part of the <code>dashboardr</code> package. This guide
demonstrates how to use this function to generate interactive heatmaps.
In this demonstration, we will use the <code>gss_2020</code> dataset
from the <code>gssr</code> package to walk you through how to use the
function.</p>
<p>The <code>create_heatmap</code> function is designed to simplify the
creation of highly customizable heatmaps from raw or aggregated data.
Heatmaps are excellent for visualizing the relationship between two
categorical variables and a continuous outcome, using color intensity to
represent values. This function was designed to aid communication
science researchers, and other social science researchers, to visualize
data formats common in this line of work, namely, survey data.</p>
<p>It handles common data preparation steps such as:</p>
<ul>
<li>Converting <code>haven_labelled</code> columns (e.g., from SPSS
imports) to R factors.</li>
<li>Mapping raw values to more descriptive labels.</li>
<li>Ordering categorical levels.</li>
<li>Explicitly including or excluding <code>NA</code> values as distinct
categories.</li>
<li>Aggregating <code>value_var</code> if multiple observations exist
for a given <code>(x, y)</code> cell.</li>
<li>Setting up titles, labels, tooltips, and color scales.</li>
</ul>
<p>This vignette demonstrates how to use the
<code><a href="../reference/create_heatmap.html">create_heatmap()</a></code> function with the General Social Survey
(GSS) Panel 2020 dataset. The GSS Panel 2020 dataset follows the same
respondents across three waves (2016, 2018, 2020), providing rich
longitudinal data for understanding social attitudes and demographic
patterns.</p>
</div>
<div class="section level3">
<h3 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h3>
<p>First, let’s load the necessary libraries and the
<code>gss_2020</code> dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kjhealy/gssr" class="external-link">gssr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jkunst.com/highcharter/" class="external-link">highcharter</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://favstats.github.io/dashboardr/">dashboardr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load GSS Panel 2020 data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gss_panel20</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>With any data analysis, the first step is to examine the data
(namely, the variables) that we’re working with.</p>
<p>Once we have an idea of what the data looks like, we then need to
prepare our data by creating some meaningful categorical variables.</p>
<p>To keep it straightforward, we’re going to work with the first wave
of data, demarcated by the ‘_1a’ suffix.</p>
<p>Let’s do so now:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check available _1a variables</span></span>
<span><span class="va">wave_1a_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gss_panel20</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_1a$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gss_panel20</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Available _1a variables:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Available _1a variables:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">wave_1a_vars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Show first 20</span></span>
<span><span class="co">#&gt;  [1] "wtssall_1a" "wtssnr_1a"  "vstrat_1a"  "vpsu_1a"    "year_1a"   </span></span>
<span><span class="co">#&gt;  [6] "id_1a"      "mar1_1a"    "mar2_1a"    "mar3_1a"    "mar4_1a"   </span></span>
<span><span class="co">#&gt; [11] "mar5_1a"    "mar6_1a"    "mar7_1a"    "mar8_1a"    "mar9_1a"   </span></span>
<span><span class="co">#&gt; [16] "mar10_1a"   "mar11_1a"   "mar12_1a"   "mar13_1a"   "mar14_1a"</span></span>
<span></span>
<span><span class="co"># Create a working dataset with key _1a variables</span></span>
<span><span class="va">gss_clean</span> <span class="op">&lt;-</span> <span class="va">gss_panel20</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Select relevant variables from wave 1a (2016)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="co"># Demographics</span></span>
<span>    <span class="va">age_1a</span>, <span class="va">sex_1a</span>, <span class="va">race_1a</span>, <span class="va">degree_1a</span>, <span class="va">region_1a</span>,</span>
<span>    <span class="co"># Attitudes</span></span>
<span>    <span class="va">happy_1a</span>, <span class="va">trust_1a</span>, <span class="va">fair_1a</span>, <span class="va">helpful_1a</span>,</span>
<span>    <span class="co"># Economic</span></span>
<span>    <span class="va">income_1a</span>, <span class="va">class_1a</span>,</span>
<span>    <span class="co"># Political</span></span>
<span>    <span class="va">polviews_1a</span>, <span class="va">partyid_1a</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Remove rows where all key variables are missing</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age_1a</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sex_1a</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">race_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Create age groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">29</span> <span class="op">~</span> <span class="st">"18-29"</span>,</span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">44</span> <span class="op">~</span> <span class="st">"30-44"</span>, </span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">45</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">59</span> <span class="op">~</span> <span class="st">"45-59"</span>,</span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">60</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">74</span> <span class="op">~</span> <span class="st">"60-74"</span>,</span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">75</span> <span class="op">~</span> <span class="st">"75+"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Create income groups</span></span>
<span>    income_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">3</span> <span class="op">~</span> <span class="st">"Low"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">6</span> <span class="op">~</span> <span class="st">"Middle-Low"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">9</span> <span class="op">~</span> <span class="st">"Middle"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">12</span> <span class="op">~</span> <span class="st">"Middle-High"</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">12</span> <span class="op">~</span> <span class="st">"High"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check our created variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">gss_clean</span><span class="op">$</span><span class="va">age_group</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 18-29 30-44 45-59 60-74   75+  &lt;NA&gt; </span></span>
<span><span class="co">#&gt;   481   737   780   598   261    10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">gss_clean</span><span class="op">$</span><span class="va">income_group</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         Low      Middle Middle-High  Middle-Low        &lt;NA&gt; </span></span>
<span><span class="co">#&gt;         100         229        2055          49         434</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-heatmap-examples">Basic Heatmap Examples<a class="anchor" aria-label="anchor" href="#basic-heatmap-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-1-average-age-by-education-and-gender">Example 1: Average Age by Education and Gender<a class="anchor" aria-label="anchor" href="#example-1-average-age-by-education-and-gender"></a>
</h3>
<p>Let’s create a heatmap showing the average age across education
levels and gender.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## TODO: some labels are off here also include the average age as text within the heatmap?</span></span>
<span><span class="co"># Prepare data for heatmap</span></span>
<span><span class="va">age_education_data</span> <span class="op">&lt;-</span> <span class="va">gss_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">degree_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sex_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">degree_1a</span>, <span class="va">sex_1a</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age_1a</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create basic heatmap</span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">age_education_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"degree_1a"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"sex_1a"</span>, </span>
<span>  value_var <span class="op">=</span> <span class="st">"avg_age"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Average Age by Education Level and Gender"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"GSS Panel 2016 Wave"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Education Level"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Gender"</span>,</span>
<span>  value_label <span class="op">=</span> <span class="st">"Average Age"</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ffffff"</span>, <span class="st">"#2E86AB"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Average Age by Education Level and Gender"},"yAxis":{"title":{"text":"sex_1a"},"categories":["1","2"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"GSS Panel 2016 Wave"},"xAxis":{"categories":["0","1","2","3","4"],"title":{"text":"degree_1a"},"opposite":false},"colorAxis":{"min":46.76404494382022,"max":53.9618320610687,"stops":[[0,"#ffffff"],[1,"#2E86AB"]],"title":{"text":"avg_age"}},"series":[{"group":"group","data":[{".x_plot":"0",".y_plot":"1",".value_plot":51.68493150684931,"x":0,"y":0,"value":51.68493150684931,"xf":"0","yf":"1"},{".x_plot":"0",".y_plot":"2",".value_plot":52.71270718232044,"x":0,"y":1,"value":52.71270718232044,"xf":"0","yf":"2"},{".x_plot":"1",".y_plot":"1",".value_plot":46.95310136157337,"x":1,"y":0,"value":46.95310136157337,"xf":"1","yf":"1"},{".x_plot":"1",".y_plot":"2",".value_plot":49.29559748427672,"x":1,"y":1,"value":49.29559748427672,"xf":"1","yf":"2"},{".x_plot":"2",".y_plot":"1",".value_plot":46.76404494382022,"x":2,"y":0,"value":46.76404494382022,"xf":"2","yf":"1"},{".x_plot":"2",".y_plot":"2",".value_plot":47.94488188976378,"x":2,"y":1,"value":47.94488188976378,"xf":"2","yf":"2"},{".x_plot":"3",".y_plot":"1",".value_plot":47.64462809917355,"x":3,"y":0,"value":47.64462809917355,"xf":"3","yf":"1"},{".x_plot":"3",".y_plot":"2",".value_plot":48.52054794520548,"x":3,"y":1,"value":48.52054794520548,"xf":"3","yf":"2"},{".x_plot":"4",".y_plot":"1",".value_plot":53.9618320610687,"x":4,"y":0,"value":53.9618320610687,"xf":"4","yf":"1"},{".x_plot":"4",".y_plot":"2",".value_plot":52.35675675675675,"x":4,"y":1,"value":52.35675675675675,"xf":"4","yf":"2"}],"type":"heatmap","name":"avg_age","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"transparent"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>avg_age: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="example-2-income-distribution-with-custom-ordering">Example 2: Income Distribution with Custom Ordering<a class="anchor" aria-label="anchor" href="#example-2-income-distribution-with-custom-ordering"></a>
</h3>
<p>Let’s examine the relationship between age groups and education,
showing average income.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## TODO: some labels are off here also include the average age as text within the heatmap?</span></span>
<span></span>
<span><span class="co"># Prepare income data</span></span>
<span><span class="va">income_data</span> <span class="op">&lt;-</span> <span class="va">gss_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">degree_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="va">degree_1a</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">income_1a</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define custom orders</span></span>
<span><span class="va">age_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-29"</span>, <span class="st">"30-44"</span>, <span class="st">"45-59"</span>, <span class="st">"60-74"</span>, <span class="st">"75+"</span><span class="op">)</span></span>
<span><span class="va">education_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lt High School"</span>, <span class="st">"High School"</span>, <span class="st">"Junior College"</span>, <span class="st">"Bachelor"</span>, <span class="st">"Graduate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create heatmap with custom ordering</span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">income_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"degree_1a"</span>,</span>
<span>  value_var <span class="op">=</span> <span class="st">"avg_income"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Average Income by Age Group and Education"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"Higher values indicate higher income categories (2016)"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Age Group"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Education Level"</span>, </span>
<span>  value_label <span class="op">=</span> <span class="st">"Income Level"</span>,</span>
<span>  x_order <span class="op">=</span> <span class="va">age_order</span>,</span>
<span>  y_order <span class="op">=</span> <span class="va">education_order</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#fff7ec"</span>, <span class="st">"#fee8c8"</span>, <span class="st">"#fdd49e"</span>, <span class="st">"#fdbb84"</span>, <span class="st">"#fc8d59"</span>, <span class="st">"#ef6548"</span>, <span class="st">"#d7301f"</span><span class="op">)</span>,</span>
<span>  tooltip_prefix <span class="op">=</span> <span class="st">"Income Level: "</span>,</span>
<span>  x_tooltip_suffix <span class="op">=</span> <span class="st">" years old"</span>,</span>
<span>  data_labels_format <span class="op">=</span> <span class="st">"{point.value:.1f}"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Average Income by Age Group and Education"},"yAxis":{"title":{"text":"degree_1a"},"categories":["0","1","2","3","4"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"Higher values indicate higher income categories (2016)"},"xAxis":{"categories":["18-29","30-44","45-59","60-74","75+"],"title":{"text":"age_group"},"opposite":false},"colorAxis":{"min":8.75,"max":11.92,"stops":[[0,"#fff7ec"],[0.1666666666666667,"#fee8c8"],[0.3333333333333333,"#fdd49e"],[0.5,"#fdbb84"],[0.6666666666666666,"#fc8d59"],[0.8333333333333334,"#ef6548"],[1,"#d7301f"]],"title":{"text":"avg_income"}},"series":[{"group":"group","data":[{".x_plot":"18-29",".y_plot":"0",".value_plot":8.75,"x":0,"y":0,"value":8.75,"xf":"18-29","yf":"0"},{".x_plot":"18-29",".y_plot":"1",".value_plot":10.63018867924528,"x":0,"y":1,"value":10.63018867924528,"xf":"18-29","yf":"1"},{".x_plot":"18-29",".y_plot":"2",".value_plot":10.6969696969697,"x":0,"y":2,"value":10.6969696969697,"xf":"18-29","yf":"2"},{".x_plot":"18-29",".y_plot":"3",".value_plot":11.046875,"x":0,"y":3,"value":11.046875,"xf":"18-29","yf":"3"},{".x_plot":"18-29",".y_plot":"4",".value_plot":11.25,"x":0,"y":4,"value":11.25,"xf":"18-29","yf":"4"},{".x_plot":"30-44",".y_plot":"0",".value_plot":9.794520547945206,"x":1,"y":0,"value":9.794520547945206,"xf":"30-44","yf":"0"},{".x_plot":"30-44",".y_plot":"1",".value_plot":10.96529968454259,"x":1,"y":1,"value":10.96529968454259,"xf":"30-44","yf":"1"},{".x_plot":"30-44",".y_plot":"2",".value_plot":11.01754385964912,"x":1,"y":2,"value":11.01754385964912,"xf":"30-44","yf":"2"},{".x_plot":"30-44",".y_plot":"3",".value_plot":11.84375,"x":1,"y":3,"value":11.84375,"xf":"30-44","yf":"3"},{".x_plot":"30-44",".y_plot":"4",".value_plot":11.68493150684932,"x":1,"y":4,"value":11.68493150684932,"xf":"30-44","yf":"4"},{".x_plot":"45-59",".y_plot":"0",".value_plot":10.08219178082192,"x":2,"y":0,"value":10.08219178082192,"xf":"45-59","yf":"0"},{".x_plot":"45-59",".y_plot":"1",".value_plot":10.72910662824208,"x":2,"y":1,"value":10.72910662824208,"xf":"45-59","yf":"1"},{".x_plot":"45-59",".y_plot":"2",".value_plot":11.15384615384615,"x":2,"y":2,"value":11.15384615384615,"xf":"45-59","yf":"2"},{".x_plot":"45-59",".y_plot":"3",".value_plot":11.61475409836066,"x":2,"y":3,"value":11.61475409836066,"xf":"45-59","yf":"3"},{".x_plot":"45-59",".y_plot":"4",".value_plot":11.70491803278689,"x":2,"y":4,"value":11.70491803278689,"xf":"45-59","yf":"4"},{".x_plot":"60-74",".y_plot":"0",".value_plot":9.387755102040817,"x":3,"y":0,"value":9.387755102040817,"xf":"60-74","yf":"0"},{".x_plot":"60-74",".y_plot":"1",".value_plot":11,"x":3,"y":1,"value":11,"xf":"60-74","yf":"1"},{".x_plot":"60-74",".y_plot":"2",".value_plot":11.025,"x":3,"y":2,"value":11.025,"xf":"60-74","yf":"2"},{".x_plot":"60-74",".y_plot":"3",".value_plot":11.71590909090909,"x":3,"y":3,"value":11.71590909090909,"xf":"60-74","yf":"3"},{".x_plot":"60-74",".y_plot":"4",".value_plot":11.8169014084507,"x":3,"y":4,"value":11.8169014084507,"xf":"60-74","yf":"4"},{".x_plot":"75+",".y_plot":"0",".value_plot":9.390243902439025,"x":4,"y":0,"value":9.390243902439025,"xf":"75+","yf":"0"},{".x_plot":"75+",".y_plot":"1",".value_plot":10.90909090909091,"x":4,"y":1,"value":10.90909090909091,"xf":"75+","yf":"1"},{".x_plot":"75+",".y_plot":"2",".value_plot":11.6,"x":4,"y":2,"value":11.6,"xf":"75+","yf":"2"},{".x_plot":"75+",".y_plot":"3",".value_plot":11.13793103448276,"x":4,"y":3,"value":11.13793103448276,"xf":"75+","yf":"3"},{".x_plot":"75+",".y_plot":"4",".value_plot":11.92,"x":4,"y":4,"value":11.92,"xf":"75+","yf":"4"}],"type":"heatmap","name":"avg_income","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value:.1f}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"transparent"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>avg_income: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="advanced-heatmap-features">Advanced Heatmap Features<a class="anchor" aria-label="anchor" href="#advanced-heatmap-features"></a>
</h2>
<div class="section level3">
<h3 id="example-3-including-missing-values">Example 3: Including Missing Values<a class="anchor" aria-label="anchor" href="#example-3-including-missing-values"></a>
</h3>
<p>Let’s create a heatmap that explicitly shows missing data
patterns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## TODO: some labels are off here also include the average age as text within the heatmap?</span></span>
<span></span>
<span><span class="co"># Create data with some missing values for demonstration</span></span>
<span><span class="va">happiness_data</span> <span class="op">&lt;-</span> <span class="va">gss_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Keep some NAs to demonstrate include_na feature</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">race_1a</span>, <span class="va">class_1a</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    avg_happy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">happy_1a</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Convert NaN to NA for demonstration</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>avg_happy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">avg_happy</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="va">avg_happy</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create heatmap including NAs</span></span>
<span><span class="va">plot3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">happiness_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"race_1a"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"class_1a"</span>,</span>
<span>  value_var <span class="op">=</span> <span class="st">"avg_happy"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Average Happiness by Race and Social Class"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"Including missing data patterns (2016)"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Race/Ethnicity"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Social Class"</span>,</span>
<span>  value_label <span class="op">=</span> <span class="st">"Happiness Level"</span>,</span>
<span>  include_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  na_label_x <span class="op">=</span> <span class="st">"Race Not Specified"</span>,</span>
<span>  na_label_y <span class="op">=</span> <span class="st">"Class Not Specified"</span>, </span>
<span>  na_color <span class="op">=</span> <span class="st">"#cccccc"</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#d7191c"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#ffffbf"</span>, <span class="st">"#abdda4"</span>, <span class="st">"#2b83ba"</span><span class="op">)</span>,</span>
<span>  tooltip_prefix <span class="op">=</span> <span class="st">"Happiness: "</span>,</span>
<span>  tooltip_suffix <span class="op">=</span> <span class="st">" (1-3 scale)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot3</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Average Happiness by Race and Social Class"},"yAxis":{"title":{"text":"class_1a"},"categories":["1","2","3","4","Class Not Specified"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"Including missing data patterns (2016)"},"xAxis":{"categories":["1","2","3"],"title":{"text":"race_1a"},"opposite":false},"colorAxis":{"min":1.446428571428571,"max":2.253731343283582,"stops":[[0,"#d7191c"],[0.25,"#fdae61"],[0.5,"#ffffbf"],[0.75,"#abdda4"],[1,"#2b83ba"]],"title":{"text":"avg_happy"}},"series":[{"group":"group","data":[{".x_plot":"1",".y_plot":"1",".value_plot":2.243386243386243,"x":0,"y":0,"value":2.243386243386243,"xf":"1","yf":"1"},{".x_plot":"1",".y_plot":"2",".value_plot":1.92568306010929,"x":0,"y":1,"value":1.92568306010929,"xf":"1","yf":"2"},{".x_plot":"1",".y_plot":"3",".value_plot":1.73449401523395,"x":0,"y":2,"value":1.73449401523395,"xf":"1","yf":"3"},{".x_plot":"1",".y_plot":"4",".value_plot":1.446428571428571,"x":0,"y":3,"value":1.446428571428571,"xf":"1","yf":"4"},{".x_plot":"1",".y_plot":"Class Not Specified",".value_plot":2.058823529411764,"x":0,"y":4,"value":2.058823529411764,"xf":"1","yf":"Class Not Specified"},{".x_plot":"2",".y_plot":"1",".value_plot":2.253731343283582,"x":1,"y":0,"value":2.253731343283582,"xf":"2","yf":"1"},{".x_plot":"2",".y_plot":"2",".value_plot":1.948148148148148,"x":1,"y":1,"value":1.948148148148148,"xf":"2","yf":"2"},{".x_plot":"2",".y_plot":"3",".value_plot":1.953125,"x":1,"y":2,"value":1.953125,"xf":"2","yf":"3"},{".x_plot":"2",".y_plot":"4",".value_plot":2,"x":1,"y":3,"value":2,"xf":"2","yf":"4"},{".x_plot":"2",".y_plot":"Class Not Specified",".value_plot":1.666666666666667,"x":1,"y":4,"value":1.666666666666667,"xf":"2","yf":"Class Not Specified"},{".x_plot":"3",".y_plot":"1",".value_plot":2.178571428571428,"x":2,"y":0,"value":2.178571428571428,"xf":"3","yf":"1"},{".x_plot":"3",".y_plot":"2",".value_plot":1.833333333333333,"x":2,"y":1,"value":1.833333333333333,"xf":"3","yf":"2"},{".x_plot":"3",".y_plot":"3",".value_plot":1.65625,"x":2,"y":2,"value":1.65625,"xf":"3","yf":"3"},{".x_plot":"3",".y_plot":"4",".value_plot":1.833333333333333,"x":2,"y":3,"value":1.833333333333333,"xf":"3","yf":"4"},{".x_plot":"3",".y_plot":"Class Not Specified",".value_plot":1.5,"x":2,"y":4,"value":1.5,"xf":"3","yf":"Class Not Specified"}],"type":"heatmap","name":"avg_happy","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"#cccccc"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>avg_happy: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="example-4-custom-value-mapping-and-aggregation">Example 4: Custom Value Mapping and Aggregation<a class="anchor" aria-label="anchor" href="#example-4-custom-value-mapping-and-aggregation"></a>
</h3>
<p>Let’s use value mapping to create more readable labels and
demonstrate different aggregation functions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## TODO: some labels are off here also include the average age as text within the heatmap?</span></span>
<span></span>
<span><span class="co"># Prepare data with mapping</span></span>
<span><span class="va">political_data</span> <span class="op">&lt;-</span> <span class="va">gss_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">polviews_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">partyid_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trust_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Convert to character for mapping</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    polviews_char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">polviews_1a</span><span class="op">)</span>,</span>
<span>    partyid_char <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">partyid_1a</span><span class="op">)</span>,</span>
<span>    trust_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">trust_1a</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create mappings for cleaner labels</span></span>
<span><span class="va">polviews_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Extremely Liberal"</span> <span class="op">=</span> <span class="st">"Ext Liberal"</span>,</span>
<span>  <span class="st">"Liberal"</span> <span class="op">=</span> <span class="st">"Liberal"</span>,</span>
<span>  <span class="st">"Slightly Liberal"</span> <span class="op">=</span> <span class="st">"Sl Liberal"</span>, </span>
<span>  <span class="st">"Moderate"</span> <span class="op">=</span> <span class="st">"Moderate"</span>,</span>
<span>  <span class="st">"Slightly Conservative"</span> <span class="op">=</span> <span class="st">"Sl Conservative"</span>,</span>
<span>  <span class="st">"Conservative"</span> <span class="op">=</span> <span class="st">"Conservative"</span>,</span>
<span>  <span class="st">"Extremely Conservative"</span> <span class="op">=</span> <span class="st">"Ext Conservative"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">partyid_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Strong Democrat"</span> <span class="op">=</span> <span class="st">"Strong Dem"</span>,</span>
<span>  <span class="st">"Not Very Strong Democrat"</span> <span class="op">=</span> <span class="st">"Weak Dem"</span>,</span>
<span>  <span class="st">"Independent, Close to Democrat"</span> <span class="op">=</span> <span class="st">"Lean Dem"</span>,</span>
<span>  <span class="st">"Independent"</span> <span class="op">=</span> <span class="st">"Independent"</span>,</span>
<span>  <span class="st">"Independent, Close to Republican"</span> <span class="op">=</span> <span class="st">"Lean Rep"</span>, </span>
<span>  <span class="st">"Not Very Strong Republican"</span> <span class="op">=</span> <span class="st">"Weak Rep"</span>,</span>
<span>  <span class="st">"Strong Republican"</span> <span class="op">=</span> <span class="st">"Strong Rep"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate data first</span></span>
<span><span class="va">trust_political_data</span> <span class="op">&lt;-</span> <span class="va">political_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">polviews_char</span>, <span class="va">partyid_char</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    median_trust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">trust_numeric</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create heatmap with mapping and median aggregation</span></span>
<span><span class="va">plot4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trust_political_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"polviews_char"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"partyid_char"</span>,</span>
<span>  value_var <span class="op">=</span> <span class="st">"median_trust"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Median Trust Levels by Political Views and Party ID"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"Using median aggregation and custom label mapping (2016)"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Political Views"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Party Identification"</span>,</span>
<span>  value_label <span class="op">=</span> <span class="st">"Trust Level"</span>,</span>
<span>  x_map_values <span class="op">=</span> <span class="va">polviews_map</span>,</span>
<span>  y_map_values <span class="op">=</span> <span class="va">partyid_map</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ca0020"</span>, <span class="st">"#f4a582"</span>, <span class="st">"#ffffff"</span>, <span class="st">"#92c5de"</span>, <span class="st">"#0571b0"</span><span class="op">)</span>,</span>
<span>  color_min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  color_max <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  tooltip_prefix <span class="op">=</span> <span class="st">"Median Trust: "</span>,</span>
<span>  tooltip_suffix <span class="op">=</span> <span class="st">"/3"</span>,</span>
<span>  data_labels_format <span class="op">=</span> <span class="st">"{point.value:.2f}"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot4</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Median Trust Levels by Political Views and Party ID"},"yAxis":{"title":{"text":"partyid_char"},"categories":["0","1","2","3","4","5","6","7"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"Using median aggregation and custom label mapping (2016)"},"xAxis":{"categories":["1","2","3","4","5","6","7"],"title":{"text":"polviews_char"},"opposite":false},"colorAxis":{"min":1,"max":2,"stops":[[0,"#ca0020"],[0.25,"#f4a582"],[0.5,"#ffffff"],[0.75,"#92c5de"],[1,"#0571b0"]],"title":{"text":"median_trust"}},"series":[{"group":"group","data":[{".x_plot":"1",".y_plot":"0",".value_plot":1,"x":0,"y":0,"value":1,"xf":"1","yf":"0"},{".x_plot":"1",".y_plot":"1",".value_plot":2,"x":0,"y":1,"value":2,"xf":"1","yf":"1"},{".x_plot":"1",".y_plot":"2",".value_plot":2,"x":0,"y":2,"value":2,"xf":"1","yf":"2"},{".x_plot":"1",".y_plot":"3",".value_plot":2,"x":0,"y":3,"value":2,"xf":"1","yf":"3"},{".x_plot":"1",".y_plot":"4",".value_plot":2,"x":0,"y":4,"value":2,"xf":"1","yf":"4"},{".x_plot":"1",".y_plot":"5",".value_plot":2,"x":0,"y":5,"value":2,"xf":"1","yf":"5"},{".x_plot":"1",".y_plot":"6",".value_plot":2,"x":0,"y":6,"value":2,"xf":"1","yf":"6"},{".x_plot":"1",".y_plot":"7",".value_plot":1.5,"x":0,"y":7,"value":1.5,"xf":"1","yf":"7"},{".x_plot":"2",".y_plot":"0",".value_plot":1,"x":1,"y":0,"value":1,"xf":"2","yf":"0"},{".x_plot":"2",".y_plot":"1",".value_plot":1,"x":1,"y":1,"value":1,"xf":"2","yf":"1"},{".x_plot":"2",".y_plot":"2",".value_plot":2,"x":1,"y":2,"value":2,"xf":"2","yf":"2"},{".x_plot":"2",".y_plot":"3",".value_plot":2,"x":1,"y":3,"value":2,"xf":"2","yf":"3"},{".x_plot":"2",".y_plot":"4",".value_plot":2,"x":1,"y":4,"value":2,"xf":"2","yf":"4"},{".x_plot":"2",".y_plot":"5",".value_plot":1,"x":1,"y":5,"value":1,"xf":"2","yf":"5"},{".x_plot":"2",".y_plot":"6",".value_plot":2,"x":1,"y":6,"value":2,"xf":"2","yf":"6"},{".x_plot":"2",".y_plot":"7",".value_plot":1,"x":1,"y":7,"value":1,"xf":"2","yf":"7"},{".x_plot":"3",".y_plot":"0",".value_plot":2,"x":2,"y":0,"value":2,"xf":"3","yf":"0"},{".x_plot":"3",".y_plot":"1",".value_plot":2,"x":2,"y":1,"value":2,"xf":"3","yf":"1"},{".x_plot":"3",".y_plot":"2",".value_plot":1,"x":2,"y":2,"value":1,"xf":"3","yf":"2"},{".x_plot":"3",".y_plot":"3",".value_plot":2,"x":2,"y":3,"value":2,"xf":"3","yf":"3"},{".x_plot":"3",".y_plot":"4",".value_plot":2,"x":2,"y":4,"value":2,"xf":"3","yf":"4"},{".x_plot":"3",".y_plot":"5",".value_plot":2,"x":2,"y":5,"value":2,"xf":"3","yf":"5"},{".x_plot":"3",".y_plot":"6",".value_plot":2,"x":2,"y":6,"value":2,"xf":"3","yf":"6"},{".x_plot":"3",".y_plot":"7",".value_plot":2,"x":2,"y":7,"value":2,"xf":"3","yf":"7"},{".x_plot":"4",".y_plot":"0",".value_plot":2,"x":3,"y":0,"value":2,"xf":"4","yf":"0"},{".x_plot":"4",".y_plot":"1",".value_plot":2,"x":3,"y":1,"value":2,"xf":"4","yf":"1"},{".x_plot":"4",".y_plot":"2",".value_plot":2,"x":3,"y":2,"value":2,"xf":"4","yf":"2"},{".x_plot":"4",".y_plot":"3",".value_plot":2,"x":3,"y":3,"value":2,"xf":"4","yf":"3"},{".x_plot":"4",".y_plot":"4",".value_plot":2,"x":3,"y":4,"value":2,"xf":"4","yf":"4"},{".x_plot":"4",".y_plot":"5",".value_plot":2,"x":3,"y":5,"value":2,"xf":"4","yf":"5"},{".x_plot":"4",".y_plot":"6",".value_plot":2,"x":3,"y":6,"value":2,"xf":"4","yf":"6"},{".x_plot":"4",".y_plot":"7",".value_plot":2,"x":3,"y":7,"value":2,"xf":"4","yf":"7"},{".x_plot":"5",".y_plot":"0",".value_plot":2,"x":4,"y":0,"value":2,"xf":"5","yf":"0"},{".x_plot":"5",".y_plot":"1",".value_plot":2,"x":4,"y":1,"value":2,"xf":"5","yf":"1"},{".x_plot":"5",".y_plot":"2",".value_plot":2,"x":4,"y":2,"value":2,"xf":"5","yf":"2"},{".x_plot":"5",".y_plot":"3",".value_plot":2,"x":4,"y":3,"value":2,"xf":"5","yf":"3"},{".x_plot":"5",".y_plot":"4",".value_plot":2,"x":4,"y":4,"value":2,"xf":"5","yf":"4"},{".x_plot":"5",".y_plot":"5",".value_plot":2,"x":4,"y":5,"value":2,"xf":"5","yf":"5"},{".x_plot":"5",".y_plot":"6",".value_plot":2,"x":4,"y":6,"value":2,"xf":"5","yf":"6"},{".x_plot":"5",".y_plot":"7",".value_plot":2,"x":4,"y":7,"value":2,"xf":"5","yf":"7"},{".x_plot":"6",".y_plot":"0",".value_plot":2,"x":5,"y":0,"value":2,"xf":"6","yf":"0"},{".x_plot":"6",".y_plot":"1",".value_plot":2,"x":5,"y":1,"value":2,"xf":"6","yf":"1"},{".x_plot":"6",".y_plot":"2",".value_plot":2,"x":5,"y":2,"value":2,"xf":"6","yf":"2"},{".x_plot":"6",".y_plot":"3",".value_plot":2,"x":5,"y":3,"value":2,"xf":"6","yf":"3"},{".x_plot":"6",".y_plot":"4",".value_plot":2,"x":5,"y":4,"value":2,"xf":"6","yf":"4"},{".x_plot":"6",".y_plot":"5",".value_plot":2,"x":5,"y":5,"value":2,"xf":"6","yf":"5"},{".x_plot":"6",".y_plot":"6",".value_plot":2,"x":5,"y":6,"value":2,"xf":"6","yf":"6"},{".x_plot":"6",".y_plot":"7",".value_plot":1,"x":5,"y":7,"value":1,"xf":"6","yf":"7"},{".x_plot":"7",".y_plot":"0",".value_plot":2,"x":6,"y":0,"value":2,"xf":"7","yf":"0"},{".x_plot":"7",".y_plot":"1",".value_plot":2,"x":6,"y":1,"value":2,"xf":"7","yf":"1"},{".x_plot":"7",".y_plot":"2",".value_plot":2,"x":6,"y":2,"value":2,"xf":"7","yf":"2"},{".x_plot":"7",".y_plot":"3",".value_plot":2,"x":6,"y":3,"value":2,"xf":"7","yf":"3"},{".x_plot":"7",".y_plot":"4",".value_plot":2,"x":6,"y":4,"value":2,"xf":"7","yf":"4"},{".x_plot":"7",".y_plot":"5",".value_plot":2,"x":6,"y":5,"value":2,"xf":"7","yf":"5"},{".x_plot":"7",".y_plot":"6",".value_plot":2,"x":6,"y":6,"value":2,"xf":"7","yf":"6"},{".x_plot":"7",".y_plot":"7",".value_plot":2,"x":6,"y":7,"value":2,"xf":"7","yf":"7"}],"type":"heatmap","name":"median_trust","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value:.2f}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"transparent"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>median_trust: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="example-5-regional-analysis-with-custom-colors">Example 5: Regional Analysis with Custom Colors<a class="anchor" aria-label="anchor" href="#example-5-regional-analysis-with-custom-colors"></a>
</h3>
<p>Let’s examine regional patterns in social attitudes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare regional data</span></span>
<span><span class="va">regional_data</span> <span class="op">&lt;-</span> <span class="va">gss_clean</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">region_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">degree_1a</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fair_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fair_numeric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fair_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">region_1a</span>, <span class="va">degree_1a</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    avg_fairness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fair_numeric</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n_responses <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Only include cells with at least 5 responses</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>avg_fairness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">n_responses</span> <span class="op">&gt;=</span> <span class="fl">5</span>, <span class="va">avg_fairness</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create heatmap with custom styling</span></span>
<span><span class="va">plot5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">regional_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"region_1a"</span>, </span>
<span>  y_var <span class="op">=</span> <span class="st">"degree_1a"</span>,</span>
<span>  value_var <span class="op">=</span> <span class="st">"avg_fairness"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Perceived Fairness by Region and Education"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"Cells with &lt;5 responses shown as missing (2016)"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"US Region"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Education Level"</span>,</span>
<span>  value_label <span class="op">=</span> <span class="st">"Fairness Rating"</span>,</span>
<span>  y_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lt High School"</span>, <span class="st">"High School"</span>, <span class="st">"Junior College"</span>, <span class="st">"Bachelor"</span>, <span class="st">"Graduate"</span><span class="op">)</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ffffcc"</span>, <span class="st">"#a1dab4"</span>, <span class="st">"#41b6c4"</span>, <span class="st">"#2c7fb8"</span>, <span class="st">"#253494"</span><span class="op">)</span>,</span>
<span>  na_color <span class="op">=</span> <span class="st">"#f0f0f0"</span>,</span>
<span>  tooltip_prefix <span class="op">=</span> <span class="st">"Fairness: "</span>,</span>
<span>  tooltip_suffix <span class="op">=</span> <span class="st">" (1-3 scale)"</span>,</span>
<span>  x_tooltip_prefix <span class="op">=</span> <span class="st">"Region: "</span>,</span>
<span>  y_tooltip_prefix <span class="op">=</span> <span class="st">"Education: "</span>,</span>
<span>  data_labels_format <span class="op">=</span> <span class="st">"{point.value:.2f}"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot5</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-1fb4450895fe099f74a1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-1fb4450895fe099f74a1">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Perceived Fairness by Region and Education"},"yAxis":{"title":{"text":"degree_1a"},"categories":["0","1","2","3","4"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"Cells with <5 responses shown as missing (2016)"},"xAxis":{"categories":["1","2","3","4","5","6","7","8","9"],"title":{"text":"region_1a"},"opposite":false},"colorAxis":{"min":1.294117647058824,"max":2.222222222222222,"stops":[[0,"#ffffcc"],[0.25,"#a1dab4"],[0.5,"#41b6c4"],[0.75,"#2c7fb8"],[1,"#253494"]],"title":{"text":"avg_fairness"}},"series":[{"group":"group","data":[{".x_plot":"1",".y_plot":"0",".value_plot":1.454545454545455,"x":0,"y":0,"value":1.454545454545455,"xf":"1","yf":"0"},{".x_plot":"1",".y_plot":"1",".value_plot":1.66,"x":0,"y":1,"value":1.66,"xf":"1","yf":"1"},{".x_plot":"1",".y_plot":"2",".value_plot":1.6,"x":0,"y":2,"value":1.6,"xf":"1","yf":"2"},{".x_plot":"1",".y_plot":"3",".value_plot":1.785714285714286,"x":0,"y":3,"value":1.785714285714286,"xf":"1","yf":"3"},{".x_plot":"1",".y_plot":"4",".value_plot":2,"x":0,"y":4,"value":2,"xf":"1","yf":"4"},{".x_plot":"2",".y_plot":"0",".value_plot":1.294117647058824,"x":1,"y":0,"value":1.294117647058824,"xf":"2","yf":"0"},{".x_plot":"2",".y_plot":"1",".value_plot":1.705882352941176,"x":1,"y":1,"value":1.705882352941176,"xf":"2","yf":"1"},{".x_plot":"2",".y_plot":"2",".value_plot":1.636363636363636,"x":1,"y":2,"value":1.636363636363636,"xf":"2","yf":"2"},{".x_plot":"2",".y_plot":"3",".value_plot":1.704545454545455,"x":1,"y":3,"value":1.704545454545455,"xf":"2","yf":"3"},{".x_plot":"2",".y_plot":"4",".value_plot":1.838709677419355,"x":1,"y":4,"value":1.838709677419355,"xf":"2","yf":"4"},{".x_plot":"3",".y_plot":"0",".value_plot":1.464285714285714,"x":2,"y":0,"value":1.464285714285714,"xf":"3","yf":"0"},{".x_plot":"3",".y_plot":"1",".value_plot":1.647727272727273,"x":2,"y":1,"value":1.647727272727273,"xf":"3","yf":"1"},{".x_plot":"3",".y_plot":"2",".value_plot":1.35,"x":2,"y":2,"value":1.35,"xf":"3","yf":"2"},{".x_plot":"3",".y_plot":"3",".value_plot":1.813333333333333,"x":2,"y":3,"value":1.813333333333333,"xf":"3","yf":"3"},{".x_plot":"3",".y_plot":"4",".value_plot":1.852941176470588,"x":2,"y":4,"value":1.852941176470588,"xf":"3","yf":"4"},{".x_plot":"4",".y_plot":"0",".value_plot":1.444444444444444,"x":3,"y":0,"value":1.444444444444444,"xf":"4","yf":"0"},{".x_plot":"4",".y_plot":"1",".value_plot":1.753246753246753,"x":3,"y":1,"value":1.753246753246753,"xf":"4","yf":"1"},{".x_plot":"4",".y_plot":"2",".value_plot":1.75,"x":3,"y":2,"value":1.75,"xf":"4","yf":"2"},{".x_plot":"4",".y_plot":"3",".value_plot":1.666666666666667,"x":3,"y":3,"value":1.666666666666667,"xf":"4","yf":"3"},{".x_plot":"4",".y_plot":"4",".value_plot":2.222222222222222,"x":3,"y":4,"value":2.222222222222222,"xf":"4","yf":"4"},{".x_plot":"5",".y_plot":"0",".value_plot":1.485714285714286,"x":4,"y":0,"value":1.485714285714286,"xf":"5","yf":"0"},{".x_plot":"5",".y_plot":"1",".value_plot":1.537688442211055,"x":4,"y":1,"value":1.537688442211055,"xf":"5","yf":"1"},{".x_plot":"5",".y_plot":"2",".value_plot":1.6875,"x":4,"y":2,"value":1.6875,"xf":"5","yf":"2"},{".x_plot":"5",".y_plot":"3",".value_plot":1.712121212121212,"x":4,"y":3,"value":1.712121212121212,"xf":"5","yf":"3"},{".x_plot":"5",".y_plot":"4",".value_plot":1.947368421052632,"x":4,"y":4,"value":1.947368421052632,"xf":"5","yf":"4"},{".x_plot":"6",".y_plot":"0",".value_plot":1.411764705882353,"x":5,"y":0,"value":1.411764705882353,"xf":"6","yf":"0"},{".x_plot":"6",".y_plot":"1",".value_plot":1.480519480519481,"x":5,"y":1,"value":1.480519480519481,"xf":"6","yf":"1"},{".x_plot":"6",".y_plot":"2",".value_plot":null,"x":5,"y":2,"value":null,"xf":"6","yf":"2"},{".x_plot":"6",".y_plot":"3",".value_plot":1.636363636363636,"x":5,"y":3,"value":1.636363636363636,"xf":"6","yf":"3"},{".x_plot":"6",".y_plot":"4",".value_plot":1.866666666666667,"x":5,"y":4,"value":1.866666666666667,"xf":"6","yf":"4"},{".x_plot":"7",".y_plot":"0",".value_plot":1.352941176470588,"x":6,"y":0,"value":1.352941176470588,"xf":"7","yf":"0"},{".x_plot":"7",".y_plot":"1",".value_plot":1.522935779816514,"x":6,"y":1,"value":1.522935779816514,"xf":"7","yf":"1"},{".x_plot":"7",".y_plot":"2",".value_plot":1.578947368421053,"x":6,"y":2,"value":1.578947368421053,"xf":"7","yf":"2"},{".x_plot":"7",".y_plot":"3",".value_plot":1.833333333333333,"x":6,"y":3,"value":1.833333333333333,"xf":"7","yf":"3"},{".x_plot":"7",".y_plot":"4",".value_plot":1.916666666666667,"x":6,"y":4,"value":1.916666666666667,"xf":"7","yf":"4"},{".x_plot":"8",".y_plot":"0",".value_plot":1.411764705882353,"x":7,"y":0,"value":1.411764705882353,"xf":"8","yf":"0"},{".x_plot":"8",".y_plot":"1",".value_plot":1.540229885057471,"x":7,"y":1,"value":1.540229885057471,"xf":"8","yf":"1"},{".x_plot":"8",".y_plot":"2",".value_plot":1.75,"x":7,"y":2,"value":1.75,"xf":"8","yf":"2"},{".x_plot":"8",".y_plot":"3",".value_plot":1.935483870967742,"x":7,"y":3,"value":1.935483870967742,"xf":"8","yf":"3"},{".x_plot":"8",".y_plot":"4",".value_plot":2,"x":7,"y":4,"value":2,"xf":"8","yf":"4"},{".x_plot":"9",".y_plot":"0",".value_plot":1.675675675675676,"x":8,"y":0,"value":1.675675675675676,"xf":"9","yf":"0"},{".x_plot":"9",".y_plot":"1",".value_plot":1.547826086956522,"x":8,"y":1,"value":1.547826086956522,"xf":"9","yf":"1"},{".x_plot":"9",".y_plot":"2",".value_plot":1.608695652173913,"x":8,"y":2,"value":1.608695652173913,"xf":"9","yf":"2"},{".x_plot":"9",".y_plot":"3",".value_plot":1.773584905660377,"x":8,"y":3,"value":1.773584905660377,"xf":"9","yf":"3"},{".x_plot":"9",".y_plot":"4",".value_plot":1.875,"x":8,"y":4,"value":1.875,"xf":"9","yf":"4"}],"type":"heatmap","name":"avg_fairness","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value:.2f}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"#f0f0f0"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>avg_fairness: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="longitudinal-analysis">Longitudinal Analysis<a class="anchor" aria-label="anchor" href="#longitudinal-analysis"></a>
</h2>
<div class="section level3">
<h3 id="example-6-change-over-time">Example 6: Change Over Time<a class="anchor" aria-label="anchor" href="#example-6-change-over-time"></a>
</h3>
<p>Let’s examine how attitudes changed across the panel waves.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a comparison dataset using multiple waves</span></span>
<span><span class="va">wave_comparison_data</span> <span class="op">&lt;-</span> <span class="va">gss_panel20</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="co"># Select happiness from different waves</span></span>
<span>    <span class="va">happy_1a</span>, <span class="va">happy_1b</span>, <span class="va">happy_2</span>,</span>
<span>    <span class="co"># Demographics from wave 1a</span></span>
<span>    <span class="va">age_1a</span>, <span class="va">sex_1a</span>, <span class="va">degree_1a</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Create age groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">35</span> <span class="op">~</span> <span class="st">"18-35"</span>,</span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">36</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">50</span> <span class="op">~</span> <span class="st">"36-50"</span>,</span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;=</span> <span class="fl">51</span> <span class="op">&amp;</span> <span class="va">age_1a</span> <span class="op">&lt;=</span> <span class="fl">65</span> <span class="op">~</span> <span class="st">"51-65"</span>, </span>
<span>      <span class="va">age_1a</span> <span class="op">&gt;</span> <span class="fl">65</span> <span class="op">~</span> <span class="st">"65+"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Reshape to long format</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">happy_1a</span>, <span class="va">happy_1b</span>, <span class="va">happy_2</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"wave"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"happiness"</span>,</span>
<span>    names_prefix <span class="op">=</span> <span class="st">"happy_"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Clean wave labels</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    wave <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"1a"</span> <span class="op">~</span> <span class="st">"2016 Wave 1"</span>,</span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"1b"</span> <span class="op">~</span> <span class="st">"2016 Wave 2"</span>, </span>
<span>      <span class="va">wave</span> <span class="op">==</span> <span class="st">"2"</span> <span class="op">~</span> <span class="st">"2018"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">wave</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Filter out missing values</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sex_1a</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Aggregate by age group and wave</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="va">wave</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    avg_happiness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">happiness</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n_cases <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">'drop'</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Only include cells with sufficient cases</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>avg_happiness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">n_cases</span> <span class="op">&gt;=</span> <span class="fl">10</span>, <span class="va">avg_happiness</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create cross-wave heatmap</span></span>
<span><span class="va">plot6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_heatmap.html">create_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">wave_comparison_data</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"wave"</span>,</span>
<span>  value_var <span class="op">=</span> <span class="st">"avg_happiness"</span>, </span>
<span>  title <span class="op">=</span> <span class="st">"Average Happiness Across Waves by Age Group"</span>,</span>
<span>  subtitle <span class="op">=</span> <span class="st">"Comparing happiness levels across different survey waves"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Age Group"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Survey Wave"</span>,</span>
<span>  value_label <span class="op">=</span> <span class="st">"Happiness Level"</span>,</span>
<span>  x_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-35"</span>, <span class="st">"36-50"</span>, <span class="st">"51-65"</span>, <span class="st">"65+"</span><span class="op">)</span>,</span>
<span>  y_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2016 Wave 1"</span>, <span class="st">"2016 Wave 2"</span>, <span class="st">"2018"</span><span class="op">)</span>,</span>
<span>  color_palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#d7191c"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#ffffbf"</span>, <span class="st">"#abdda4"</span>, <span class="st">"#2b83ba"</span><span class="op">)</span>,</span>
<span>  color_min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  color_max <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  tooltip_prefix <span class="op">=</span> <span class="st">"Happiness: "</span>,</span>
<span>  tooltip_suffix <span class="op">=</span> <span class="st">" (1-3 scale)"</span>,</span>
<span>  data_labels_format <span class="op">=</span> <span class="st">"{point.value:.2f}"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot6</span></span></code></pre></div>
<div class="highchart html-widget html-fill-item" id="htmlwidget-10b3b7155e8045a1b2ad" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-10b3b7155e8045a1b2ad">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"heatmap"},"title":{"text":"Average Happiness Across Waves by Age Group"},"yAxis":{"title":{"text":"wave"},"categories":["2016 Wave 1","2018"]},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"subtitle":{"text":"Comparing happiness levels across different survey waves"},"xAxis":{"categories":["18-35","36-50","51-65","65+"],"title":{"text":"age_group"},"opposite":false},"colorAxis":{"min":1.862129144851658,"max":2.180790960451978,"stops":[[0,"#d7191c"],[0.25,"#fdae61"],[0.5,"#ffffbf"],[0.75,"#abdda4"],[1,"#2b83ba"]],"title":{"text":"avg_happiness"}},"series":[{"group":"group","data":[{".x_plot":"18-35",".y_plot":"2016 Wave 1",".value_plot":1.883691529709229,"x":0,"y":0,"value":1.883691529709229,"xf":"18-35","yf":"2016 Wave 1"},{".x_plot":"18-35",".y_plot":"2018",".value_plot":2.121951219512195,"x":0,"y":1,"value":2.121951219512195,"xf":"18-35","yf":"2018"},{".x_plot":"36-50",".y_plot":"2016 Wave 1",".value_plot":1.886297376093294,"x":1,"y":0,"value":1.886297376093294,"xf":"36-50","yf":"2016 Wave 1"},{".x_plot":"36-50",".y_plot":"2018",".value_plot":2.180790960451978,"x":1,"y":1,"value":2.180790960451978,"xf":"36-50","yf":"2018"},{".x_plot":"51-65",".y_plot":"2016 Wave 1",".value_plot":1.871088861076346,"x":2,"y":0,"value":1.871088861076346,"xf":"51-65","yf":"2016 Wave 1"},{".x_plot":"51-65",".y_plot":"2018",".value_plot":2.083969465648855,"x":2,"y":1,"value":2.083969465648855,"xf":"51-65","yf":"2018"},{".x_plot":"65+",".y_plot":"2016 Wave 1",".value_plot":1.862129144851658,"x":3,"y":0,"value":1.862129144851658,"xf":"65+","yf":"2016 Wave 1"},{".x_plot":"65+",".y_plot":"2018",".value_plot":2.093167701863354,"x":3,"y":1,"value":2.093167701863354,"xf":"65+","yf":"2018"}],"type":"heatmap","name":"avg_happiness","plotOptions":{"heatmap":{"dataLabels":{"enabled":true,"format":"{point.value:.2f}","color":"#000000","style":{"textOutline":"none"}},"nullColor":"transparent"}}}],"tooltip":{"formatter":"function() {\n      // Access categories using this.series.xAxis.categories and this.series.yAxis.categories\n      // this.point.x and this.point.y are the numerical indices\n      var x_cat = this.series.xAxis.categories[this.point.x];\n      var y_cat = this.series.yAxis.categories[this.point.y];\n      var value = this.point.value;\n\n      var value_str = Highcharts.numberFormat(value, 0); // Format value (e.g., 0 decimals)\n      if (value === null) {\n          value_str = 'N/A'; // Display N/A for null values in tooltip\n      }\n\n      return '<b>' + '' + x_cat + '<\/b><br/>' + // Using x_tooltip_prefix here\n             '<b>' + '' + y_cat + '<\/b><br/>' + // Using y_tooltip_prefix here\n             '<b>avg_happiness: <\/b>' + '' + value_str + '';\n    }","valueDecimals":0}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="summary-and-best-practices">Summary and Best Practices<a class="anchor" aria-label="anchor" href="#summary-and-best-practices"></a>
</h2>
<div class="section level3">
<h3 id="key-features-demonstrated">Key Features Demonstrated<a class="anchor" aria-label="anchor" href="#key-features-demonstrated"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Basic heatmaps</strong> with continuous values mapped to
color intensity</li>
<li>
<strong>Custom ordering</strong> of categorical variables for
logical presentation</li>
<li>
<strong>Missing value handling</strong> with explicit NA categories
and custom colors</li>
<li>
<strong>Value mapping</strong> for cleaner, more readable
labels</li>
<li>
<strong>Custom color palettes</strong> for different data types and
emphasis</li>
<li>
<strong>Flexible aggregation</strong> using different functions
(mean, median)</li>
<li>
<strong>Longitudinal analysis</strong> showing change over time</li>
</ol>
</div>
<div class="section level3">
<h3 id="best-practices-for-heatmaps">Best Practices for Heatmaps<a class="anchor" aria-label="anchor" href="#best-practices-for-heatmaps"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Always check your data structure first!</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">your_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">your_data</span><span class="op">$</span><span class="va">x_var</span>, <span class="va">your_data</span><span class="op">$</span><span class="va">y_var</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Consider your audience when choosing colors</span></span>
<span><span class="co"># - Use diverging palettes for data with meaningful zero/center point</span></span>
<span><span class="co"># - Use sequential palettes for data with natural ordering</span></span>
<span><span class="co"># - Ensure accessibility with colorblind-friendly palettes</span></span>
<span></span>
<span><span class="co"># 3. Handle missing data thoughtfully</span></span>
<span><span class="co"># - Decide whether to include or exclude missing categories</span></span>
<span><span class="co"># - Use appropriate colors for missing data (often gray or transparent)</span></span>
<span><span class="co"># - Document missing data patterns in subtitles</span></span>
<span></span>
<span><span class="co"># 4. Order categories logically</span></span>
<span><span class="co"># - Use natural ordering (e.g., age groups, education levels)</span></span>
<span><span class="co"># - Consider frequency-based ordering for nominal categories</span></span>
<span><span class="co"># - Place "Other" or "Missing" categories at the end</span></span>
<span></span>
<span><span class="co"># 5. Customize tooltips for clarity</span></span>
<span><span class="co"># - Include units and context</span></span>
<span><span class="co"># - Use prefixes/suffixes to clarify meaning</span></span>
<span><span class="co"># - Format numbers appropriately for your audience</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p>The <code><a href="../reference/create_heatmap.html">create_heatmap()</a></code> function provides a powerful and
flexible way to visualize bivariate relationships in survey data. By
leveraging the rich GSS Panel 2020 dataset, we’ve demonstrated how
heatmaps can reveal patterns in:</p>
<ul>
<li>Demographic distributions</li>
<li>Attitude variations across groups<br>
</li>
<li>Regional and temporal patterns</li>
<li>Missing data structures</li>
</ul>
<p>The function’s extensive customization options allow for
publication-ready visualizations that can effectively communicate
complex social science findings to diverse audiences.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
